<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Stephen Barrie">
<meta name="dcterms.date" content="2022-11-08">

<title>Into the Unknown - Excelosaurus</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Into the Unknown</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">Stephen Barrie</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Stephen137" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/sjbarrie" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Excelosaurus</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">fastai</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Stephen Barrie </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 8, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#creating-our-dataset" id="toc-creating-our-dataset" class="nav-link active" data-scroll-target="#creating-our-dataset">Creating our dataset</a>
  <ul class="collapse">
  <li><a href="#data-source" id="toc-data-source" class="nav-link" data-scroll-target="#data-source">Data source</a></li>
  <li><a href="#independent-variables-features" id="toc-independent-variables-features" class="nav-link" data-scroll-target="#independent-variables-features">Independent variables (features)</a>
  <ul class="collapse">
  <li><a href="#categorical-features" id="toc-categorical-features" class="nav-link" data-scroll-target="#categorical-features">Categorical features</a></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">Feature engineering</a></li>
  </ul></li>
  <li><a href="#dependent-target-variables-labels" id="toc-dependent-target-variables-labels" class="nav-link" data-scroll-target="#dependent-target-variables-labels">Dependent | Target variables (labels)</a></li>
  <li><a href="#linear-model" id="toc-linear-model" class="nav-link" data-scroll-target="#linear-model">Linear model</a>
  <ul class="collapse">
  <li><a href="#weights-parameters" id="toc-weights-parameters" class="nav-link" data-scroll-target="#weights-parameters">Weights | Parameters</a></li>
  <li><a href="#calculating-our-loss" id="toc-calculating-our-loss" class="nav-link" data-scroll-target="#calculating-our-loss">Calculating our loss</a></li>
  </ul></li>
  <li><a href="#a-neural-network" id="toc-a-neural-network" class="nav-link" data-scroll-target="#a-neural-network">A neural network</a></li>
  <li><a href="#using-matrix-multiplication" id="toc-using-matrix-multiplication" class="nav-link" data-scroll-target="#using-matrix-multiplication">Using Matrix Multiplication</a></li>
  <li><a href="#gradient-descent" id="toc-gradient-descent" class="nav-link" data-scroll-target="#gradient-descent">Gradient Descent</a></li>
  <li><a href="#final-thoughts" id="toc-final-thoughts" class="nav-link" data-scroll-target="#final-thoughts">Final thoughts</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>This is my follow up to <a href="https://www.youtube.com/watch?v=hBBOjCiFcuo&amp;list=PLfYUBJiXbdtSvpQjSnJJ_PmDQB_VyT5iU&amp;index=3"><strong><em>Lesson 3: Practical Deep Learning for Coders 2022</em></strong></a> in which Jeremy built a linear regression model, and neural net from scratch (from the Titanic dataset) using the ‘dinosaur’ named ‘Excelosaurus’!</p>
<section id="creating-our-dataset" class="level1">
<h1>Creating our dataset</h1>
<section id="data-source" class="level2">
<h2 class="anchored" data-anchor-id="data-source">Data source</h2>
<p>I managed to ‘reptilicate’ Jeremy’s example by creating my own dataset in Excel from my son’s favourite dino book, which is written in Polish. He is bilingual so thankfully he was able to help me with the translation :)</p>
<p><img src="http://localhost:8888/files/Fast.ai/Lesson%205/Dinozaur.jpg?_xsrf=2%7C95560dd1%7C6918e91c3184cbd802fb99e8fd7c631d%7C1667156297" style="width:400px;height:400px"></p>
</section>
<section id="independent-variables-features" class="level2">
<h2 class="anchored" data-anchor-id="independent-variables-features">Independent variables (features)</h2>
<p>The book provided some very basic information about each dinosaur:</p>
<pre><code>- Name 
- Period (Cretaceous, Jurassic, Triassic)
- Discovered (South America, North America, Europe, Asia etc. - 8 unique locations)
- Min_Len (metres)
- Max_Len (metres)
- Min_Height (metres)
- Max_Height (metres)
- Min_Weight (000 kg)
- Max_Weight (000 kg)</code></pre>
<p>These are our independent variables (or features).</p>
<section id="categorical-features" class="level3">
<h3 class="anchored" data-anchor-id="categorical-features">Categorical features</h3>
<p>Our model needs data in numerical format however as we can see from above, we have values for <em>Period</em> and <em>Discovered</em> which are clearly not numerical. How do we represent these in numerical format?</p>
<p>Well, the trick is to create a <a href="https://www.displayr.com/what-are-dummy-variables/"><strong><em>dummy variable</em></strong></a> which creates <strong>n-1</strong> columns where n is the number of categories:</p>
<pre><code>for our Period variable ( n(3) - 1 ) = 2 columns created 

for our Discovered variable ( n(8) - 1) = 7 columns created</code></pre>
<p>We then populate these columns with a numerical value of <strong>1</strong> to indicate that our dino falls into that category, or <strong>0</strong> to signal that it does not.</p>
</section>
<section id="feature-engineering" class="level3">
<h3 class="anchored" data-anchor-id="feature-engineering">Feature engineering</h3>
<p>Due to the nature and limited number of features provided by the book I performed some very basic <a href="https://en.wikipedia.org/wiki/Feature_engineering"><strong><em>feature engineering</em></strong></a> to try to help our model with its predictions.</p>
<section id="creating-new-features" class="level4">
<h4 class="anchored" data-anchor-id="creating-new-features">Creating new features</h4>
<p>I created some new features from the existing info:</p>
<pre><code>- Ave_Len
- Ave_Height
- Ave_Weight
- Ave_Weight_Length</code></pre>
</section>
<section id="normalization" class="level4">
<h4 class="anchored" data-anchor-id="normalization">Normalization</h4>
<p>Another thing I noticed was that the values for the dino dimensions are very large in comparison to our newly created dummy variables, and risk dominating our model, relegating the categorical features, which may actually hold some predictive insight! To counter this I used a simple <a href="https://developers.google.com/machine-learning/data-prep/transform/normalization"><strong><em>normalization</em></strong></a> technique to squeeze the values for the dino dimensions between 0 and 1, by dividing each of the original values by the maximum value for that column. This results in a maximum value of <strong>1</strong> for the largest original value (anything divided by itself = 1) with the other values spread out proporionately betweeen 0 and 1.</p>
</section>
</section>
</section>
<section id="dependent-target-variables-labels" class="level2">
<h2 class="anchored" data-anchor-id="dependent-target-variables-labels">Dependent | Target variables (labels)</h2>
<p>The book also classified the dinos as either:</p>
<pre><code>- roslinozernosc (veggie) ; or 
- miesozernosc (meat-eater)</code></pre>
<p>These are our dependent or target variables (or labels).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Excelosaurus_files/figure-html/a7a8ca06-cbb7-464d-8f1b-e3824aa794f5-1-3d825e94-c96d-4c3a-8550-70446c121297.PNG" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Features.PNG</figcaption>
</figure>
</div>
</section>
<section id="linear-model" class="level2">
<h2 class="anchored" data-anchor-id="linear-model">Linear model</h2>
<p>Our task here can be represented on a basic level by a linear model</p>
<p><strong><em>y = wx + b</em></strong></p>
<p>where we try to map the independent variables <strong><em>x_1, x_2, …, x_n</em></strong> (our dino features) to our target variable <strong><em>y</em></strong> (1 = meat eater, 0 = veggie).</p>
<p>We already have our values for <strong><em>x</em></strong> and <strong><em>y</em></strong>, and because our dummy variables already cover the entire dataset e.g.&nbsp;there’s a column for “Cretaceous”, “Jurassic”, and “Triassic”, and every dino in the dataset was around during exactly one of these; therefore, we don’t need a separate intercep(or bias) term <strong><em>b</em></strong> to cover rows that aren’t otherwise part of a column.</p>
<p>That just leaves us to compute the values for <strong><em>w</em></strong> - the <strong>weights</strong> applied to each of our features!</p>
<section id="weights-parameters" class="level3">
<h3 class="anchored" data-anchor-id="weights-parameters">Weights | Parameters</h3>
<p>The first step is to initilaise random weights | parameter for each of our chosen input features. To do this in excel:</p>
<pre><code>= RAND()-0.5</code></pre>
<p>Subtracting -0.5 is an arbitrary technique, but it is useful as it tightens up the random values around either side of zero.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Excelosaurus_files/figure-html/1ea54768-a794-4fc4-b796-21a75b9a7ac0-1-c23e9aac-97d1-4fd6-9213-147eb195473d.PNG" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Parameters.PNG</figcaption>
</figure>
</div>
<p>Now that we have our weightings, we can populate our Prediction column, which takes our feature values and multiplies them by our randomly generated weightings.</p>
<p>We can use the <a href="https://support.microsoft.com/en-us/office/sumproduct-function-16753e75-9f68-4874-94ac-4d2145a2fd2e">SUMPRODUCT</a> function within excel to performs this quickly and efficiently across all rows of our dataset in one fell swoop!</p>
<p>=SUMPRODUCT(Table2[@[Ave_Weight_Length]:[Ones]],$AD<span class="math inline">\(10:\)</span>AQ$10)</p>
</section>
<section id="calculating-our-loss" class="level3">
<h3 class="anchored" data-anchor-id="calculating-our-loss">Calculating our loss</h3>
<p>It is important from the outset to specify which loss function is to be used. There are a number of different loss functions and it is often unclear which should be used for the particular task at hand. <a href="https://machinelearningmastery.com/how-to-choose-loss-functions-when-training-deep-learning-neural-networks/">This article</a> provides a useful guide.</p>
<section id="mean-squared-error" class="level4">
<h4 class="anchored" data-anchor-id="mean-squared-error">Mean squared error</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Excelosaurus_files/figure-html/a81a6b01-3cf2-4753-82f5-d50e97d4bbcb-1-0b3fd006-9d0e-4314-9781-15307a6a2869.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">MSE.jpg</figcaption>
</figure>
</div>
<p>I chose <a href="https://en.wikipedia.org/wiki/Mean_squared_error">mean squared error</a> (as used in Jeremy’s Titanic dataset walkthough) as my loss function. Our task, predicting whether a dino is a meat eater [1] or veggie [0] is a binary classification problem, similar to the Kaggle Titanic competition, where the task was to predict survived or not-survived.</p>
<p>For each dino we simply square the difference between our prediction value (BB10) and the target value (Table2(<span class="citation" data-cites="Target">@Target</span>). The squared error for one dino prediction is calculated in excel as follows:</p>
<pre><code>=(BB10-Table2[@Target])^2</code></pre>
<p>Our total loss or MSE is then simply the average across all <strong><em>n</em></strong> (60) dinos:</p>
<pre><code>=AVERAGE(BD10:BD69)</code></pre>
</section>
<section id="cross-entropy-loss" class="level4">
<h4 class="anchored" data-anchor-id="cross-entropy-loss">Cross-entropy loss</h4>
<p>Having done some digging on loss functions, there is the suggestion that <a href="https://machinelearningmastery.com/cross-entropy-for-machine-learning/">Cross-entropy</a> is the default loss function to use for binary classification problems. The mathematical formula is:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Excelosaurus_files/figure-html/bd72574b-2dfa-4a21-85db-c7940b0abf34-1-e7328ddf-882c-4e85-925d-1911bfd6798a.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">cross_entropy.png</figcaption>
</figure>
</div>
<p>It turns out Jeremy posted a <a href="https://www.youtube.com/watch?v=AcA8HAYh7IE&amp;t=1844s">very useful video</a> a few years back on how to calculate this using Excel and there is a useful summary provided <a href="https://amaarora.github.io/2020/07/18/label-smoothing.html">here</a> by <a href="https://github.com/amaarora">Aman Arora</a>.</p>
</section>
</section>
</section>
<section id="a-neural-network" class="level2">
<h2 class="anchored" data-anchor-id="a-neural-network">A neural network</h2>
<p>We can add another linear layer to our exisitng linear model, although this in itself would not constitute a neural network. What we can do however, is add rectified linear activation functions or <a href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)">ReLU</a> for short.</p>
<p>In simple terms this function clips the values produced by our linear models so that they all lie between 0 and 1. This can easily be achieved in Excel using an if function:</p>
<pre><code>if AS&lt;0,0,AS</code></pre>
<p>Our predictions are then updated to include the outputs from both linear models and the two ReLUs, and our loss also updated accordingly with reference to the original unchanged target values - meat-eater [1] veggie [0].</p>
</section>
<section id="using-matrix-multiplication" class="level2">
<h2 class="anchored" data-anchor-id="using-matrix-multiplication"><a href="https://en.wikipedia.org/wiki/Matrix_multiplication">Using Matrix Multiplication</a></h2>
<p>Matrix Multiplication is one of the most fundamental computational tasks and, one of the core mathematical operations in today’s neural networks. Not the sort of thing you might expect to be found in Excel perhaps? Well it turns out that there is function called <a href="https://support.microsoft.com/en-us/office/mmult-function-40593ed7-a3cd-4b6b-b9a3-e4ad3c7245eb">MMULT</a> built into excel.</p>
<p>All we need to do is transpose our randomized weights and our features, so that the input features are now the rows, and the weights values are incuded in column format.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Excelosaurus_files/figure-html/689b84de-7b27-4151-8a1a-b775eb239c6d-1-646eaad5-f09b-48e5-854c-6f634ef60ba0.PNG" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Matrix Mult.PNG</figcaption>
</figure>
</div>
<p>An example from one of the cells from our linear model prediction is included below:</p>
<pre><code>=MMULT(Table2456[[Ave_Weight_Length]:[Const]],AE20:AF33)</code></pre>
<p>The first part of the formula:</p>
<pre><code>Table2456[[Ave_Weight_Length]:[Const]]</code></pre>
<p>is the range over which we are computing matrix multiplicaiton - i.e our features data</p>
<p>The second part of the formula:</p>
<pre><code>AE20:AF33</code></pre>
<p>is our parameters/weightings</p>
<p>Finally, it’s time to now update our initial randomized parameters using Gradient Descent, which we can do in excel!</p>
</section>
<section id="gradient-descent" class="level2">
<h2 class="anchored" data-anchor-id="gradient-descent">Gradient Descent</h2>
<p><img src="http://localhost:8888/files/Fast.ai/Lesson%205/Gradient%20Descent.jpg?_xsrf=2%7C95560dd1%7C6918e91c3184cbd802fb99e8fd7c631d%7C1667156297" style="width:800px;height:400px"></p>
<p><a href="https://ml-cheatsheet.readthedocs.io/en/latest/gradient_descent.html">Gradient descent</a> is an optimization algorithm used to minimize some function by iteratively moving in the direction of steepest descent as defined by the negative of the gradient. In machine learning, we use gradient descent to update the parameters of our model. Parameters refer to coefficients in Linear Regression and weights in neural networks.</p>
<p>It might be that you are familiar with <strong><em>Solver</em></strong> function within Excel, as part of an optimization strategy? Well this is basically Gradient Descent to give it another name.</p>
<p>We can use this Solver function to optimise our loss function.</p>
<p>The steps required within excel are as follows:</p>
<ul>
<li><p>click on the Data tab then select the Solver function (as highlighted below) Note, you may have to add this function to your dashboard. See <a href="https://www.excel-easy.com/data-analysis/solver.html">this guide</a> for details on how to do this.</p></li>
<li><p>Set Objective: enter the cell reference for your total loss</p></li>
<li><p>To: select Min (we are seeking to minimise our total loss)</p></li>
<li><p>By Changing Variable cells: select the range of our parameters (we want to update our original randomized values)</p></li>
<li><p>Make Unconstrianed Variables Non-Negative: ensure this is UNticked</p></li>
<li><p>Select a Solving Method: select GRG Nonlinear from the dropdown</p></li>
</ul>
<p>Finally, hit <strong><em>Solve</em></strong> and wait a few moments. You should find that your parameters have been updated to optimal values, and your total loss has reduced.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Excelosaurus_files/figure-html/db050fa9-3acb-47ad-834e-c5899c218178-1-5fa024d8-9787-4c24-ae65-6e3def63bcd3.PNG" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Solver_1.PNG</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Excelosaurus_files/figure-html/6d499670-191d-4221-9991-d4100b65961c-1-e7daf5e0-5c46-4440-9633-8bc2609ae48c.PNG" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Solver_2.PNG</figcaption>
</figure>
</div>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final thoughts</h2>
<p>The main takeaway from this project, apart from hanging out with my son, and finding out about cool dinos, is that I have successfully managed to:</p>
<ul>
<li>create my own dataset from scratch</li>
<li>clean the data and perform some feature engineering</li>
<li>carry out Matrix Multiplication within Excel using the MMULT function</li>
</ul>
<p><img src="http://localhost:8888/files/Fast.ai/Lesson%205/Matrix.jpg?_xsrf=2%7C95560dd1%7C6918e91c3184cbd802fb99e8fd7c631d%7C1667156297" style="width:200px;height:200px"></p>
<ul>
<li>carry out Gradient Descent within excel using the Solver function</li>
</ul>
<p>This exercise really consolidated my understanding of the architecture of linear and neural models, and hopefully, some of the techniques included in this NoteBook prove to be helpful to other data science newcomers like me. Looking forward to Lesson 4!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>