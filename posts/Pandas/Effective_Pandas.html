<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Stephen Barrie">
<meta name="dcterms.date" content="2022-12-31">

<title>Into the Unknown - Efficient Pandas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Into the Unknown</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">Stephen Barrie</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Stephen137"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/sjbarrie"><i class="bi bi-linkedin" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Efficient Pandas</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">pandas</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Stephen Barrie </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 31, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#initial-set-up" id="toc-initial-set-up" class="nav-link" data-scroll-target="#initial-set-up">Initial set up</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#data-types" id="toc-data-types" class="nav-link" data-scroll-target="#data-types">Data Types</a></li>
  <li><a href="#integers-int" id="toc-integers-int" class="nav-link" data-scroll-target="#integers-int">Integers (int)</a></li>
  <li><a href="#chaining" id="toc-chaining" class="nav-link" data-scroll-target="#chaining">Chaining</a></li>
  <li><a href="#saving-space" id="toc-saving-space" class="nav-link" data-scroll-target="#saving-space">Saving Space</a></li>
  <li><a href="#floats" id="toc-floats" class="nav-link" data-scroll-target="#floats">Floats</a></li>
  <li><a href="#objects" id="toc-objects" class="nav-link" data-scroll-target="#objects">Objects</a></li>
  <li><a href="#dates" id="toc-dates" class="nav-link" data-scroll-target="#dates">Dates</a></li>
  <li><a href="#functions---.apply" id="toc-functions---.apply" class="nav-link" data-scroll-target="#functions---.apply">Functions - .apply</a></li>
  <li><a href="#dont-mutate" id="toc-dont-mutate" class="nav-link" data-scroll-target="#dont-mutate">Don’t Mutate</a></li>
  <li><a href="#try-to-avoid-using-.apply-where-possible" id="toc-try-to-avoid-using-.apply-where-possible" class="nav-link" data-scroll-target="#try-to-avoid-using-.apply-where-possible">Try to avoid using .apply (where possible)</a></li>
  <li><a href="#aggregation" id="toc-aggregation" class="nav-link" data-scroll-target="#aggregation">Aggregation</a></li>
  <li><a href="#visualizations" id="toc-visualizations" class="nav-link" data-scroll-target="#visualizations">Visualizations</a></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key takeaways</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Having code that is clean, readable and has a logical flow is invaluable. I discovered Structured Query Language (SQL) before Python, and as the name suggests, this already pushes you down this structured, logical road. I have only recently started to explore Python, but my experience so far is that the code can quickly become scattered and difficult to follow, particulary during the exploratory data analysis (EDA) phase.</p>
<p>I have just finished actively watching <a href="https://www.youtube.com/watch?v=zgbUk90aQ6A">Efficient Pandas</a> by <strong><a href="https://twitter.com/__mharrison__">Matt Harrison</a></strong> and decided to share the content via this blog. The video feels like a bit of a breakthrough for me, someone who is just starting out in the world of data science, and hopefully others will also benefit from reading this. Adopting the <strong>chaining</strong> method covered in this blog, whenever possible, should ensure that your code is cleaner, and reads like a recipe of ordered steps, reducing any potential ambiguities.</p>
</section>
<section id="initial-set-up" class="level2">
<h2 class="anchored" data-anchor-id="initial-set-up">Initial set up</h2>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bring in the pandas!</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check which version of pandas we're on</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pd.__version__</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>'1.5.0'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># control the pandas display features</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>pd.options.display.min_rows <span class="op">=</span> <span class="dv">20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dataset" class="level2">
<h2 class="anchored" data-anchor-id="dataset">Dataset</h2>
<p>The dataset we will be exploring is from https://www.fueleconomy.gov/feg/download.shtml which is the official U.S. government source for fuel economy information. The zipped csv file can be downloaded from <a href="https://github.com/mattharrison/datasets/blob/master/data/vehicles.csv.zip">here</a> but we can just read in the file using pandas:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in our dataset</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>autos <span class="op">=</span> pd.read_csv(<span class="st">'https://github.com/mattharrison/datasets/raw/master/data/vehicles.csv.zip'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_2753/3884461791.py:2: DtypeWarning: Columns (68,70,71,72,73,74,76,79) have mixed types. Specify dtype option on import or set low_memory=False.
  autos = pd.read_csv('https://github.com/mattharrison/datasets/raw/master/data/vehicles.csv.zip')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's take a look</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>autos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>barrels08</th>
      <th>barrelsA08</th>
      <th>charge120</th>
      <th>charge240</th>
      <th>city08</th>
      <th>city08U</th>
      <th>cityA08</th>
      <th>cityA08U</th>
      <th>cityCD</th>
      <th>cityE</th>
      <th>...</th>
      <th>mfrCode</th>
      <th>c240Dscr</th>
      <th>charge240b</th>
      <th>c240bDscr</th>
      <th>createdOn</th>
      <th>modifiedOn</th>
      <th>startStop</th>
      <th>phevCity</th>
      <th>phevHwy</th>
      <th>phevComb</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>15.695714</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>19</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>29.964545</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>9</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12.207778</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>23</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>29.964545</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>10</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17.347895</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>17</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>14.982273</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>21</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>13.184400</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>22</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>13.733750</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>23</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>12.677308</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>23</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>13.184400</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>23</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>41134</th>
      <td>16.480500</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>18</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41135</th>
      <td>12.677308</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>23</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41136</th>
      <td>13.733750</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>21</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41137</th>
      <td>11.771786</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41138</th>
      <td>13.184400</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>21</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41139</th>
      <td>14.982273</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>19</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41140</th>
      <td>14.330870</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>20</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41141</th>
      <td>15.695714</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>18</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41142</th>
      <td>15.695714</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>18</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>41143</th>
      <td>18.311667</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>16</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>41144 rows × 83 columns</p>
</div>
</div>
</div>
<p>So our dataset includes 41,144 rows and 83 columns - that’s a lot of data! Let’s have a look at the columns:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>autos.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>Index(['barrels08', 'barrelsA08', 'charge120', 'charge240', 'city08',
       'city08U', 'cityA08', 'cityA08U', 'cityCD', 'cityE', 'cityUF', 'co2',
       'co2A', 'co2TailpipeAGpm', 'co2TailpipeGpm', 'comb08', 'comb08U',
       'combA08', 'combA08U', 'combE', 'combinedCD', 'combinedUF', 'cylinders',
       'displ', 'drive', 'engId', 'eng_dscr', 'feScore', 'fuelCost08',
       'fuelCostA08', 'fuelType', 'fuelType1', 'ghgScore', 'ghgScoreA',
       'highway08', 'highway08U', 'highwayA08', 'highwayA08U', 'highwayCD',
       'highwayE', 'highwayUF', 'hlv', 'hpv', 'id', 'lv2', 'lv4', 'make',
       'model', 'mpgData', 'phevBlended', 'pv2', 'pv4', 'range', 'rangeCity',
       'rangeCityA', 'rangeHwy', 'rangeHwyA', 'trany', 'UCity', 'UCityA',
       'UHighway', 'UHighwayA', 'VClass', 'year', 'youSaveSpend', 'guzzler',
       'trans_dscr', 'tCharger', 'sCharger', 'atvType', 'fuelType2', 'rangeA',
       'evMotor', 'mfrCode', 'c240Dscr', 'charge240b', 'c240bDscr',
       'createdOn', 'modifiedOn', 'startStop', 'phevCity', 'phevHwy',
       'phevComb'],
      dtype='object')</code></pre>
</div>
</div>
</section>
<section id="data-types" class="level2">
<h2 class="anchored" data-anchor-id="data-types">Data Types</h2>
<p>Let’s concentrate our focus on a subset of the data. Let’s look at 14 of the 83 columns and also find out about the types of data included. Getting the right types will enable analysis and correctness.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's drill down and focus on just 14 of the 83 columns</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">'city08'</span>,<span class="st">'comb08'</span>, <span class="st">'highway08'</span>,<span class="st">'cylinders'</span>, <span class="st">'displ'</span>, <span class="st">'drive'</span>, <span class="st">'eng_dscr'</span>, <span class="st">'fuelCost08'</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">'make'</span>, <span class="st">'model'</span>, <span class="st">'trany'</span>, <span class="st">'range'</span>, <span class="st">'createdOn'</span>, <span class="st">'year'</span>]       </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's see the data types for each column</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>autos[cols].dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>city08          int64
comb08          int64
highway08       int64
cylinders     float64
displ         float64
drive          object
eng_dscr       object
fuelCost08      int64
make           object
model          object
trany          object
range           int64
createdOn      object
year            int64
dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's see how much memory is being used by column</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>autos[cols].memory_usage(deep<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>Index             128
city08         329152
comb08         329152
highway08      329152
cylinders      329152
displ          329152
drive         3028369
eng_dscr      2135693
fuelCost08     329152
make          2606267
model         2813134
trany         2933276
range          329152
createdOn     3497240
year           329152
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's see how much memory is being used in total</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>autos[cols].memory_usage(deep<span class="op">=</span><span class="va">True</span>).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>19647323</code></pre>
</div>
</div>
</section>
<section id="integers-int" class="level2">
<h2 class="anchored" data-anchor-id="integers-int">Integers (int)</h2>
<p>Integers(int) are numbers without a decimal point. Let’s grab some summary statistics for our integer columns:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary stats for integer columns</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a> .select_dtypes(<span class="bu">int</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a> .describe()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>city08</th>
      <th>comb08</th>
      <th>highway08</th>
      <th>fuelCost08</th>
      <th>range</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>18.369045</td>
      <td>20.616396</td>
      <td>24.504667</td>
      <td>2362.335942</td>
      <td>0.793506</td>
      <td>2001.535266</td>
    </tr>
    <tr>
      <th>std</th>
      <td>7.905886</td>
      <td>7.674535</td>
      <td>7.730364</td>
      <td>654.981925</td>
      <td>13.041592</td>
      <td>11.142414</td>
    </tr>
    <tr>
      <th>min</th>
      <td>6.000000</td>
      <td>7.000000</td>
      <td>9.000000</td>
      <td>500.000000</td>
      <td>0.000000</td>
      <td>1984.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>15.000000</td>
      <td>17.000000</td>
      <td>20.000000</td>
      <td>1900.000000</td>
      <td>0.000000</td>
      <td>1991.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>17.000000</td>
      <td>20.000000</td>
      <td>24.000000</td>
      <td>2350.000000</td>
      <td>0.000000</td>
      <td>2002.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>20.000000</td>
      <td>23.000000</td>
      <td>28.000000</td>
      <td>2700.000000</td>
      <td>0.000000</td>
      <td>2011.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>150.000000</td>
      <td>136.000000</td>
      <td>124.000000</td>
      <td>7400.000000</td>
      <td>370.000000</td>
      <td>2020.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="chaining" class="level2">
<h2 class="anchored" data-anchor-id="chaining">Chaining</h2>
<p>The above code is fine but it can quickly become cluttered and unreadable. A better way is to lean on SQL coding best practice which means that our code reads more like a recipe of ordered steps:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use chaining to grab summary stats for integer columns</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a> .select_dtypes(<span class="bu">int</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a> .describe()</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>city08</th>
      <th>comb08</th>
      <th>highway08</th>
      <th>fuelCost08</th>
      <th>range</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>18.369045</td>
      <td>20.616396</td>
      <td>24.504667</td>
      <td>2362.335942</td>
      <td>0.793506</td>
      <td>2001.535266</td>
    </tr>
    <tr>
      <th>std</th>
      <td>7.905886</td>
      <td>7.674535</td>
      <td>7.730364</td>
      <td>654.981925</td>
      <td>13.041592</td>
      <td>11.142414</td>
    </tr>
    <tr>
      <th>min</th>
      <td>6.000000</td>
      <td>7.000000</td>
      <td>9.000000</td>
      <td>500.000000</td>
      <td>0.000000</td>
      <td>1984.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>15.000000</td>
      <td>17.000000</td>
      <td>20.000000</td>
      <td>1900.000000</td>
      <td>0.000000</td>
      <td>1991.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>17.000000</td>
      <td>20.000000</td>
      <td>24.000000</td>
      <td>2350.000000</td>
      <td>0.000000</td>
      <td>2002.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>20.000000</td>
      <td>23.000000</td>
      <td>28.000000</td>
      <td>2700.000000</td>
      <td>0.000000</td>
      <td>2011.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>150.000000</td>
      <td>136.000000</td>
      <td>124.000000</td>
      <td>7400.000000</td>
      <td>370.000000</td>
      <td>2020.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Same result, much more readable code! Chaining is also known as ‘flow programming’. Rather than creating intermediate variables, leverage the fact that most operations return a new object which can be worked on.</p>
<p>Note, if you can’t find a way to chain we can use pandas <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.pipe.html">.pipe</a>. We’ll see how this works later.</p>
</section>
<section id="saving-space" class="level2">
<h2 class="anchored" data-anchor-id="saving-space">Saving Space</h2>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The int columns are currently in int64 format. Let’s try to free up some space by representing our data more memory efficiently. We can use <a href="https://numpy.org/doc/stable/reference/generated/numpy.iinfo.html">Numpy</a> to help with this:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Can comb08 column be int8?</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>np.iinfo(np.int8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>iinfo(min=-128, max=127, dtype=int8)</code></pre>
</div>
</div>
<p>The range -128 to 127 can be represented as 8 bits. (There are 256 values which in binary form can be represented by 11111111 i.e.&nbsp;8 bits). We have a maximum value of 136 for the <em>comb08</em> column so we can’t convert to int8 without losing info. We can however convert the <em>highway08</em> column to int8. Let’s try int16:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Can comb08 column be int16?</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>np.iinfo(np.int16)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>iinfo(min=-32768, max=32767, dtype=int16)</code></pre>
</div>
</div>
<p>All of our data is within this range, so we can go ahead and convert all int64 columns to int16 (and int8 for <em>highway08</em>):</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert from int64 to int16 and int8 in order to free up some memory</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># also obtain summary statistics for integer columns</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a> .astype({<span class="st">'city08'</span>: <span class="st">'int16'</span>, <span class="st">'comb08'</span>: <span class="st">'int16'</span>, <span class="st">'highway08'</span>: <span class="st">'int8'</span>,<span class="st">'fuelCost08'</span>:<span class="st">'int16'</span>, <span class="st">'range'</span>:<span class="st">'int16'</span>, <span class="st">'year'</span>:<span class="st">'int16'</span>}) </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a> .select_dtypes([<span class="st">'integer'</span>])</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a> .describe()</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>city08</th>
      <th>comb08</th>
      <th>highway08</th>
      <th>fuelCost08</th>
      <th>range</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>18.369045</td>
      <td>20.616396</td>
      <td>24.504667</td>
      <td>2362.335942</td>
      <td>0.793506</td>
      <td>2001.535266</td>
    </tr>
    <tr>
      <th>std</th>
      <td>7.905886</td>
      <td>7.674535</td>
      <td>7.730364</td>
      <td>654.981925</td>
      <td>13.041592</td>
      <td>11.142414</td>
    </tr>
    <tr>
      <th>min</th>
      <td>6.000000</td>
      <td>7.000000</td>
      <td>9.000000</td>
      <td>500.000000</td>
      <td>0.000000</td>
      <td>1984.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>15.000000</td>
      <td>17.000000</td>
      <td>20.000000</td>
      <td>1900.000000</td>
      <td>0.000000</td>
      <td>1991.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>17.000000</td>
      <td>20.000000</td>
      <td>24.000000</td>
      <td>2350.000000</td>
      <td>0.000000</td>
      <td>2002.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>20.000000</td>
      <td>23.000000</td>
      <td>28.000000</td>
      <td>2700.000000</td>
      <td>0.000000</td>
      <td>2011.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>150.000000</td>
      <td>136.000000</td>
      <td>124.000000</td>
      <td>7400.000000</td>
      <td>370.000000</td>
      <td>2020.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Let’s see if we have saved any space by converting:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check memory usage</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a> .astype({<span class="st">'city08'</span>: <span class="st">'int16'</span>, <span class="st">'comb08'</span>: <span class="st">'int16'</span>, <span class="st">'highway08'</span>: <span class="st">'int8'</span>,<span class="st">'fuelCost08'</span>:<span class="st">'int16'</span>, <span class="st">'range'</span>:<span class="st">'int16'</span>, <span class="st">'year'</span>:<span class="st">'int16'</span>}) </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a> .memory_usage(deep<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a> .<span class="bu">sum</span>() <span class="co"># was 19,647,323</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>18124995</code></pre>
</div>
</div>
<p>So a saving, but not substantial - just under 8%. Let’s see if we can improve on this:</p>
</section>
<section id="floats" class="level2">
<h2 class="anchored" data-anchor-id="floats">Floats</h2>
<p>A floating point (known as a float) number has decimal points even if that decimal point value is 0. For example: 1.13, 2.0, 1234.345. If we have a column that contains both integers and floating point numbers, Pandas will assign the entire column to the float data type so the decimal points are not lost.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's take a look at the columns with a float data type</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a> .select_dtypes(<span class="st">'float'</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>cylinders</th>
      <th>displ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12.0</td>
      <td>4.9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.0</td>
      <td>2.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8.0</td>
      <td>5.2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.0</td>
      <td>2.2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4.0</td>
      <td>1.8</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4.0</td>
      <td>1.8</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4.0</td>
      <td>1.6</td>
    </tr>
    <tr>
      <th>8</th>
      <td>4.0</td>
      <td>1.6</td>
    </tr>
    <tr>
      <th>9</th>
      <td>4.0</td>
      <td>1.8</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>41134</th>
      <td>4.0</td>
      <td>2.1</td>
    </tr>
    <tr>
      <th>41135</th>
      <td>4.0</td>
      <td>1.9</td>
    </tr>
    <tr>
      <th>41136</th>
      <td>4.0</td>
      <td>1.9</td>
    </tr>
    <tr>
      <th>41137</th>
      <td>4.0</td>
      <td>1.9</td>
    </tr>
    <tr>
      <th>41138</th>
      <td>4.0</td>
      <td>1.9</td>
    </tr>
    <tr>
      <th>41139</th>
      <td>4.0</td>
      <td>2.2</td>
    </tr>
    <tr>
      <th>41140</th>
      <td>4.0</td>
      <td>2.2</td>
    </tr>
    <tr>
      <th>41141</th>
      <td>4.0</td>
      <td>2.2</td>
    </tr>
    <tr>
      <th>41142</th>
      <td>4.0</td>
      <td>2.2</td>
    </tr>
    <tr>
      <th>41143</th>
      <td>4.0</td>
      <td>2.2</td>
    </tr>
  </tbody>
</table>
<p>41144 rows × 2 columns</p>
</div>
</div>
</div>
<p>Cylinders look int like - we would expect the number of cylinders to be an integer, and not a float (decimal).</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary stats for cylinders</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a> .cylinders</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a> .describe()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>count    40938.000000
mean         5.717084
std          1.755517
min          2.000000
25%          4.000000
50%          6.000000
75%          6.000000
max         16.000000
Name: cylinders, dtype: float64</code></pre>
</div>
</div>
<p>Oops, we have missing values - count = 40,938 but we have 41,144 rows.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's count the various values for cylinders</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a> .cylinders</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a> .value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>4.0     15938
6.0     14284
8.0      8801
5.0       771
12.0      626
3.0       279
NaN       206
10.0      170
2.0        59
16.0       10
Name: cylinders, dtype: int64</code></pre>
</div>
</div>
<p>As anticipated, we have missing values (206) represented by NaN</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">## where are they missing? We can use .query</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a> .query(<span class="st">'cylinders.isna()'</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>city08</th>
      <th>comb08</th>
      <th>highway08</th>
      <th>cylinders</th>
      <th>displ</th>
      <th>drive</th>
      <th>eng_dscr</th>
      <th>fuelCost08</th>
      <th>make</th>
      <th>model</th>
      <th>trany</th>
      <th>range</th>
      <th>createdOn</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7138</th>
      <td>81</td>
      <td>85</td>
      <td>91</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>800</td>
      <td>Nissan</td>
      <td>Altra EV</td>
      <td>NaN</td>
      <td>90</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>7139</th>
      <td>81</td>
      <td>72</td>
      <td>64</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2-Wheel Drive</td>
      <td>NaN</td>
      <td>900</td>
      <td>Toyota</td>
      <td>RAV4 EV</td>
      <td>NaN</td>
      <td>88</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>8143</th>
      <td>81</td>
      <td>72</td>
      <td>64</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2-Wheel Drive</td>
      <td>NaN</td>
      <td>900</td>
      <td>Toyota</td>
      <td>RAV4 EV</td>
      <td>NaN</td>
      <td>88</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2001</td>
    </tr>
    <tr>
      <th>8144</th>
      <td>74</td>
      <td>65</td>
      <td>58</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1000</td>
      <td>Ford</td>
      <td>Th!nk</td>
      <td>NaN</td>
      <td>29</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2001</td>
    </tr>
    <tr>
      <th>8146</th>
      <td>45</td>
      <td>39</td>
      <td>33</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2-Wheel Drive</td>
      <td>NaN</td>
      <td>1700</td>
      <td>Ford</td>
      <td>Explorer USPS Electric</td>
      <td>NaN</td>
      <td>38</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2001</td>
    </tr>
    <tr>
      <th>8147</th>
      <td>84</td>
      <td>75</td>
      <td>66</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>900</td>
      <td>Nissan</td>
      <td>Hyper-Mini</td>
      <td>NaN</td>
      <td>33</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2001</td>
    </tr>
    <tr>
      <th>9212</th>
      <td>87</td>
      <td>78</td>
      <td>69</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2-Wheel Drive</td>
      <td>NaN</td>
      <td>850</td>
      <td>Toyota</td>
      <td>RAV4 EV</td>
      <td>NaN</td>
      <td>95</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2002</td>
    </tr>
    <tr>
      <th>9213</th>
      <td>45</td>
      <td>39</td>
      <td>33</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2-Wheel Drive</td>
      <td>NaN</td>
      <td>1700</td>
      <td>Ford</td>
      <td>Explorer USPS Electric</td>
      <td>NaN</td>
      <td>38</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2002</td>
    </tr>
    <tr>
      <th>10329</th>
      <td>87</td>
      <td>78</td>
      <td>69</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2-Wheel Drive</td>
      <td>NaN</td>
      <td>850</td>
      <td>Toyota</td>
      <td>RAV4 EV</td>
      <td>NaN</td>
      <td>95</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2003</td>
    </tr>
    <tr>
      <th>21413</th>
      <td>22</td>
      <td>24</td>
      <td>28</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4-Wheel Drive</td>
      <td>NaN</td>
      <td>1750</td>
      <td>Subaru</td>
      <td>RX Turbo</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1985</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>34407</th>
      <td>73</td>
      <td>72</td>
      <td>71</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Front-Wheel Drive</td>
      <td>NaN</td>
      <td>900</td>
      <td>BYD</td>
      <td>e6</td>
      <td>Automatic (A1)</td>
      <td>187</td>
      <td>Wed Mar 13 00:00:00 EDT 2019</td>
      <td>2019</td>
    </tr>
    <tr>
      <th>34408</th>
      <td>118</td>
      <td>108</td>
      <td>97</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Front-Wheel Drive</td>
      <td>NaN</td>
      <td>600</td>
      <td>Nissan</td>
      <td>Leaf (62 kW-hr battery pack)</td>
      <td>Automatic (A1)</td>
      <td>226</td>
      <td>Wed Mar 13 00:00:00 EDT 2019</td>
      <td>2019</td>
    </tr>
    <tr>
      <th>34409</th>
      <td>114</td>
      <td>104</td>
      <td>94</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Front-Wheel Drive</td>
      <td>NaN</td>
      <td>650</td>
      <td>Nissan</td>
      <td>Leaf SV/SL (62 kW-hr battery pack)</td>
      <td>Automatic (A1)</td>
      <td>215</td>
      <td>Wed Mar 13 00:00:00 EDT 2019</td>
      <td>2019</td>
    </tr>
    <tr>
      <th>34538</th>
      <td>74</td>
      <td>74</td>
      <td>73</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>All-Wheel Drive</td>
      <td>NaN</td>
      <td>900</td>
      <td>Audi</td>
      <td>e-tron</td>
      <td>Automatic (A1)</td>
      <td>204</td>
      <td>Tue Apr 16 00:00:00 EDT 2019</td>
      <td>2019</td>
    </tr>
    <tr>
      <th>34561</th>
      <td>80</td>
      <td>76</td>
      <td>72</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4-Wheel Drive</td>
      <td>NaN</td>
      <td>850</td>
      <td>Jaguar</td>
      <td>I-Pace</td>
      <td>Automatic (A1)</td>
      <td>234</td>
      <td>Thu May 02 00:00:00 EDT 2019</td>
      <td>2020</td>
    </tr>
    <tr>
      <th>34563</th>
      <td>138</td>
      <td>131</td>
      <td>124</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Rear-Wheel Drive</td>
      <td>NaN</td>
      <td>500</td>
      <td>Tesla</td>
      <td>Model 3 Standard Range</td>
      <td>Automatic (A1)</td>
      <td>220</td>
      <td>Thu May 02 00:00:00 EDT 2019</td>
      <td>2019</td>
    </tr>
    <tr>
      <th>34564</th>
      <td>140</td>
      <td>133</td>
      <td>124</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Rear-Wheel Drive</td>
      <td>NaN</td>
      <td>500</td>
      <td>Tesla</td>
      <td>Model 3 Standard Range Plus</td>
      <td>Automatic (A1)</td>
      <td>240</td>
      <td>Thu May 02 00:00:00 EDT 2019</td>
      <td>2019</td>
    </tr>
    <tr>
      <th>34565</th>
      <td>115</td>
      <td>111</td>
      <td>107</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>All-Wheel Drive</td>
      <td>NaN</td>
      <td>600</td>
      <td>Tesla</td>
      <td>Model S Long Range</td>
      <td>Automatic (A1)</td>
      <td>370</td>
      <td>Thu May 02 00:00:00 EDT 2019</td>
      <td>2019</td>
    </tr>
    <tr>
      <th>34566</th>
      <td>104</td>
      <td>104</td>
      <td>104</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>All-Wheel Drive</td>
      <td>NaN</td>
      <td>650</td>
      <td>Tesla</td>
      <td>Model S Performance (19" Wheels)</td>
      <td>Automatic (A1)</td>
      <td>345</td>
      <td>Thu May 02 00:00:00 EDT 2019</td>
      <td>2019</td>
    </tr>
    <tr>
      <th>34567</th>
      <td>98</td>
      <td>97</td>
      <td>96</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>All-Wheel Drive</td>
      <td>NaN</td>
      <td>700</td>
      <td>Tesla</td>
      <td>Model S Performance (21" Wheels)</td>
      <td>Automatic (A1)</td>
      <td>325</td>
      <td>Thu May 02 00:00:00 EDT 2019</td>
      <td>2019</td>
    </tr>
  </tbody>
</table>
<p>206 rows × 14 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">## chaining - add cylinders and displ columns replacing NaN with 0</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a> .assign(cylinders<span class="op">=</span>autos.cylinders.fillna(<span class="dv">0</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>         displ<span class="op">=</span>autos.displ.fillna(<span class="dv">0</span>))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a> .astype({<span class="st">'city08'</span>: <span class="st">'int16'</span>, <span class="st">'comb08'</span>: <span class="st">'int16'</span>, <span class="st">'highway08'</span>: <span class="st">'int8'</span>,<span class="st">'fuelCost08'</span>:<span class="st">'int16'</span>, <span class="st">'range'</span>:<span class="st">'int16'</span>, <span class="st">'year'</span>:<span class="st">'int16'</span>}) </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a> .describe()</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>city08</th>
      <th>comb08</th>
      <th>highway08</th>
      <th>cylinders</th>
      <th>displ</th>
      <th>fuelCost08</th>
      <th>range</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
      <td>41144.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>18.369045</td>
      <td>20.616396</td>
      <td>24.504667</td>
      <td>5.688460</td>
      <td>3.277904</td>
      <td>2362.335942</td>
      <td>0.793506</td>
      <td>2001.535266</td>
    </tr>
    <tr>
      <th>std</th>
      <td>7.905886</td>
      <td>7.674535</td>
      <td>7.730364</td>
      <td>1.797009</td>
      <td>1.373415</td>
      <td>654.981925</td>
      <td>13.041592</td>
      <td>11.142414</td>
    </tr>
    <tr>
      <th>min</th>
      <td>6.000000</td>
      <td>7.000000</td>
      <td>9.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>500.000000</td>
      <td>0.000000</td>
      <td>1984.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>15.000000</td>
      <td>17.000000</td>
      <td>20.000000</td>
      <td>4.000000</td>
      <td>2.200000</td>
      <td>1900.000000</td>
      <td>0.000000</td>
      <td>1991.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>17.000000</td>
      <td>20.000000</td>
      <td>24.000000</td>
      <td>6.000000</td>
      <td>3.000000</td>
      <td>2350.000000</td>
      <td>0.000000</td>
      <td>2002.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>20.000000</td>
      <td>23.000000</td>
      <td>28.000000</td>
      <td>6.000000</td>
      <td>4.300000</td>
      <td>2700.000000</td>
      <td>0.000000</td>
      <td>2011.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>150.000000</td>
      <td>136.000000</td>
      <td>124.000000</td>
      <td>16.000000</td>
      <td>8.400000</td>
      <td>7400.000000</td>
      <td>370.000000</td>
      <td>2020.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use this to inspect float sizes</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>np.finfo(np.float16)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>finfo(resolution=0.001, min=-6.55040e+04, max=6.55040e+04, dtype=float16)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">## chaining - add cylinders and displ columns replacing NaN with 0</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a> .assign(cylinders<span class="op">=</span>autos.cylinders.fillna(<span class="dv">0</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>         displ<span class="op">=</span>autos.displ.fillna(<span class="dv">0</span>).astype(<span class="st">'float16'</span>))</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a> .astype({<span class="st">'city08'</span>: <span class="st">'int16'</span>, <span class="st">'comb08'</span>: <span class="st">'int16'</span>, <span class="st">'highway08'</span>: <span class="st">'int8'</span>,<span class="st">'fuelCost08'</span>:<span class="st">'int16'</span>, <span class="st">'range'</span>:<span class="st">'int16'</span>, <span class="st">'year'</span>:<span class="st">'int16'</span>}) </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>city08</th>
      <th>comb08</th>
      <th>highway08</th>
      <th>cylinders</th>
      <th>displ</th>
      <th>drive</th>
      <th>eng_dscr</th>
      <th>fuelCost08</th>
      <th>make</th>
      <th>model</th>
      <th>trany</th>
      <th>range</th>
      <th>createdOn</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>19</td>
      <td>21</td>
      <td>25</td>
      <td>4</td>
      <td>2.000000</td>
      <td>Rear-Wheel Drive</td>
      <td>(FFS)</td>
      <td>2000</td>
      <td>Alfa Romeo</td>
      <td>Spider Veloce 2000</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1985</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9</td>
      <td>11</td>
      <td>14</td>
      <td>12</td>
      <td>4.898438</td>
      <td>Rear-Wheel Drive</td>
      <td>(GUZZLER)</td>
      <td>3850</td>
      <td>Ferrari</td>
      <td>Testarossa</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1985</td>
    </tr>
    <tr>
      <th>2</th>
      <td>23</td>
      <td>27</td>
      <td>33</td>
      <td>4</td>
      <td>2.199219</td>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>1550</td>
      <td>Dodge</td>
      <td>Charger</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1985</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10</td>
      <td>11</td>
      <td>12</td>
      <td>8</td>
      <td>5.199219</td>
      <td>Rear-Wheel Drive</td>
      <td>NaN</td>
      <td>3850</td>
      <td>Dodge</td>
      <td>B150/B250 Wagon 2WD</td>
      <td>Automatic 3-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1985</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17</td>
      <td>19</td>
      <td>23</td>
      <td>4</td>
      <td>2.199219</td>
      <td>4-Wheel or All-Wheel Drive</td>
      <td>(FFS,TRBO)</td>
      <td>2700</td>
      <td>Subaru</td>
      <td>Legacy AWD Turbo</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>5</th>
      <td>21</td>
      <td>22</td>
      <td>24</td>
      <td>4</td>
      <td>1.799805</td>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>1900</td>
      <td>Subaru</td>
      <td>Loyale</td>
      <td>Automatic 3-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>6</th>
      <td>22</td>
      <td>25</td>
      <td>29</td>
      <td>4</td>
      <td>1.799805</td>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>1700</td>
      <td>Subaru</td>
      <td>Loyale</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>7</th>
      <td>23</td>
      <td>24</td>
      <td>26</td>
      <td>4</td>
      <td>1.599609</td>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>1750</td>
      <td>Toyota</td>
      <td>Corolla</td>
      <td>Automatic 3-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>8</th>
      <td>23</td>
      <td>26</td>
      <td>31</td>
      <td>4</td>
      <td>1.599609</td>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>1600</td>
      <td>Toyota</td>
      <td>Corolla</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>9</th>
      <td>23</td>
      <td>25</td>
      <td>30</td>
      <td>4</td>
      <td>1.799805</td>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>1700</td>
      <td>Toyota</td>
      <td>Corolla</td>
      <td>Automatic 4-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>41134</th>
      <td>18</td>
      <td>20</td>
      <td>24</td>
      <td>4</td>
      <td>2.099609</td>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>2100</td>
      <td>Saab</td>
      <td>900</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>41135</th>
      <td>23</td>
      <td>26</td>
      <td>33</td>
      <td>4</td>
      <td>1.900391</td>
      <td>Front-Wheel Drive</td>
      <td>(TBI)      (FFS)</td>
      <td>1600</td>
      <td>Saturn</td>
      <td>SL</td>
      <td>Automatic 4-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>41136</th>
      <td>21</td>
      <td>24</td>
      <td>30</td>
      <td>4</td>
      <td>1.900391</td>
      <td>Front-Wheel Drive</td>
      <td>(MFI)      (FFS)</td>
      <td>1750</td>
      <td>Saturn</td>
      <td>SL</td>
      <td>Automatic 4-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>41137</th>
      <td>24</td>
      <td>28</td>
      <td>33</td>
      <td>4</td>
      <td>1.900391</td>
      <td>Front-Wheel Drive</td>
      <td>(TBI)      (FFS)</td>
      <td>1500</td>
      <td>Saturn</td>
      <td>SL</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>41138</th>
      <td>21</td>
      <td>25</td>
      <td>32</td>
      <td>4</td>
      <td>1.900391</td>
      <td>Front-Wheel Drive</td>
      <td>(MFI)      (FFS)</td>
      <td>1700</td>
      <td>Saturn</td>
      <td>SL</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>41139</th>
      <td>19</td>
      <td>22</td>
      <td>26</td>
      <td>4</td>
      <td>2.199219</td>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>1900</td>
      <td>Subaru</td>
      <td>Legacy</td>
      <td>Automatic 4-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>41140</th>
      <td>20</td>
      <td>23</td>
      <td>28</td>
      <td>4</td>
      <td>2.199219</td>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>1850</td>
      <td>Subaru</td>
      <td>Legacy</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>41141</th>
      <td>18</td>
      <td>21</td>
      <td>24</td>
      <td>4</td>
      <td>2.199219</td>
      <td>4-Wheel or All-Wheel Drive</td>
      <td>(FFS)</td>
      <td>2000</td>
      <td>Subaru</td>
      <td>Legacy AWD</td>
      <td>Automatic 4-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>41142</th>
      <td>18</td>
      <td>21</td>
      <td>24</td>
      <td>4</td>
      <td>2.199219</td>
      <td>4-Wheel or All-Wheel Drive</td>
      <td>(FFS)</td>
      <td>2000</td>
      <td>Subaru</td>
      <td>Legacy AWD</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
    <tr>
      <th>41143</th>
      <td>16</td>
      <td>18</td>
      <td>21</td>
      <td>4</td>
      <td>2.199219</td>
      <td>4-Wheel or All-Wheel Drive</td>
      <td>(FFS,TRBO)</td>
      <td>2900</td>
      <td>Subaru</td>
      <td>Legacy AWD Turbo</td>
      <td>Automatic 4-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1993</td>
    </tr>
  </tbody>
</table>
<p>41144 rows × 14 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new memory usage</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a> <span class="co">#[cols]</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a> .loc[:,cols]</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a> .assign(cylinders<span class="op">=</span>autos.cylinders.fillna(<span class="dv">0</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>         displ<span class="op">=</span>autos.displ.fillna(<span class="dv">0</span>).astype(<span class="st">'float16'</span>))</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a> .astype({<span class="st">'city08'</span>: <span class="st">'int16'</span>, <span class="st">'comb08'</span>: <span class="st">'int16'</span>, <span class="st">'highway08'</span>: <span class="st">'int8'</span>,<span class="st">'fuelCost08'</span>:<span class="st">'int16'</span>, <span class="st">'range'</span>:<span class="st">'int16'</span>, <span class="st">'year'</span>:<span class="st">'int16'</span>}) </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a> .memory_usage(deep<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a> .<span class="bu">sum</span>() <span class="co"># was 19,647,323</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>17590123</code></pre>
</div>
</div>
<p>A further reduction.</p>
</section>
<section id="objects" class="level2">
<h2 class="anchored" data-anchor-id="objects">Objects</h2>
<p>At the very basic level, Pandas objects can be thought of as enhanced versions of NumPy structured arrays in which the rows and columns are identified with labels rather than simple integer indices.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let's take a look at our object columns</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a> .select_dtypes(<span class="bu">object</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>drive</th>
      <th>eng_dscr</th>
      <th>make</th>
      <th>model</th>
      <th>trany</th>
      <th>createdOn</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Rear-Wheel Drive</td>
      <td>(FFS)</td>
      <td>Alfa Romeo</td>
      <td>Spider Veloce 2000</td>
      <td>Manual 5-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Rear-Wheel Drive</td>
      <td>(GUZZLER)</td>
      <td>Ferrari</td>
      <td>Testarossa</td>
      <td>Manual 5-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>Dodge</td>
      <td>Charger</td>
      <td>Manual 5-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Rear-Wheel Drive</td>
      <td>NaN</td>
      <td>Dodge</td>
      <td>B150/B250 Wagon 2WD</td>
      <td>Automatic 3-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4-Wheel or All-Wheel Drive</td>
      <td>(FFS,TRBO)</td>
      <td>Subaru</td>
      <td>Legacy AWD Turbo</td>
      <td>Manual 5-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>Subaru</td>
      <td>Loyale</td>
      <td>Automatic 3-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>Subaru</td>
      <td>Loyale</td>
      <td>Manual 5-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>Toyota</td>
      <td>Corolla</td>
      <td>Automatic 3-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>Toyota</td>
      <td>Corolla</td>
      <td>Manual 5-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>Toyota</td>
      <td>Corolla</td>
      <td>Automatic 4-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>41134</th>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>Saab</td>
      <td>900</td>
      <td>Manual 5-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>41135</th>
      <td>Front-Wheel Drive</td>
      <td>(TBI)      (FFS)</td>
      <td>Saturn</td>
      <td>SL</td>
      <td>Automatic 4-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>41136</th>
      <td>Front-Wheel Drive</td>
      <td>(MFI)      (FFS)</td>
      <td>Saturn</td>
      <td>SL</td>
      <td>Automatic 4-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>41137</th>
      <td>Front-Wheel Drive</td>
      <td>(TBI)      (FFS)</td>
      <td>Saturn</td>
      <td>SL</td>
      <td>Manual 5-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>41138</th>
      <td>Front-Wheel Drive</td>
      <td>(MFI)      (FFS)</td>
      <td>Saturn</td>
      <td>SL</td>
      <td>Manual 5-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>41139</th>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>Subaru</td>
      <td>Legacy</td>
      <td>Automatic 4-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>41140</th>
      <td>Front-Wheel Drive</td>
      <td>(FFS)</td>
      <td>Subaru</td>
      <td>Legacy</td>
      <td>Manual 5-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>41141</th>
      <td>4-Wheel or All-Wheel Drive</td>
      <td>(FFS)</td>
      <td>Subaru</td>
      <td>Legacy AWD</td>
      <td>Automatic 4-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>41142</th>
      <td>4-Wheel or All-Wheel Drive</td>
      <td>(FFS)</td>
      <td>Subaru</td>
      <td>Legacy AWD</td>
      <td>Manual 5-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
    <tr>
      <th>41143</th>
      <td>4-Wheel or All-Wheel Drive</td>
      <td>(FFS,TRBO)</td>
      <td>Subaru</td>
      <td>Legacy AWD Turbo</td>
      <td>Automatic 4-spd</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
    </tr>
  </tbody>
</table>
<p>41144 rows × 6 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">## drive looks categorical</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a> .drive</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a> .value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>Front-Wheel Drive             14236
Rear-Wheel Drive              13831
4-Wheel or All-Wheel Drive     6648
All-Wheel Drive                3015
4-Wheel Drive                  1460
NaN                            1189
2-Wheel Drive                   507
Part-time 4-Wheel Drive         258
Name: drive, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Where are the missing values NaN ?</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a> .query(<span class="st">'drive.isna()'</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>city08</th>
      <th>comb08</th>
      <th>highway08</th>
      <th>cylinders</th>
      <th>displ</th>
      <th>drive</th>
      <th>eng_dscr</th>
      <th>fuelCost08</th>
      <th>make</th>
      <th>model</th>
      <th>trany</th>
      <th>range</th>
      <th>createdOn</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7138</th>
      <td>81</td>
      <td>85</td>
      <td>91</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>800</td>
      <td>Nissan</td>
      <td>Altra EV</td>
      <td>NaN</td>
      <td>90</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>8144</th>
      <td>74</td>
      <td>65</td>
      <td>58</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1000</td>
      <td>Ford</td>
      <td>Th!nk</td>
      <td>NaN</td>
      <td>29</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2001</td>
    </tr>
    <tr>
      <th>8147</th>
      <td>84</td>
      <td>75</td>
      <td>66</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>900</td>
      <td>Nissan</td>
      <td>Hyper-Mini</td>
      <td>NaN</td>
      <td>33</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2001</td>
    </tr>
    <tr>
      <th>18217</th>
      <td>18</td>
      <td>21</td>
      <td>25</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>(FFS)</td>
      <td>2000</td>
      <td>Alfa Romeo</td>
      <td>Spider Veloce 2000</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1984</td>
    </tr>
    <tr>
      <th>18218</th>
      <td>20</td>
      <td>22</td>
      <td>26</td>
      <td>4.0</td>
      <td>1.5</td>
      <td>NaN</td>
      <td>(FFS)</td>
      <td>1900</td>
      <td>Bertone</td>
      <td>X1/9</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1984</td>
    </tr>
    <tr>
      <th>18219</th>
      <td>13</td>
      <td>15</td>
      <td>20</td>
      <td>8.0</td>
      <td>5.7</td>
      <td>NaN</td>
      <td>(350 V8) (FFS)</td>
      <td>2800</td>
      <td>Chevrolet</td>
      <td>Corvette</td>
      <td>Automatic 4-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1984</td>
    </tr>
    <tr>
      <th>18220</th>
      <td>13</td>
      <td>15</td>
      <td>20</td>
      <td>8.0</td>
      <td>5.7</td>
      <td>NaN</td>
      <td>(350 V8) (FFS)</td>
      <td>2800</td>
      <td>Chevrolet</td>
      <td>Corvette</td>
      <td>Manual 4-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1984</td>
    </tr>
    <tr>
      <th>18221</th>
      <td>15</td>
      <td>17</td>
      <td>20</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>(FFS,TRBO)</td>
      <td>2500</td>
      <td>Nissan</td>
      <td>300ZX</td>
      <td>Automatic 4-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1984</td>
    </tr>
    <tr>
      <th>18222</th>
      <td>16</td>
      <td>18</td>
      <td>20</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>(FFS)</td>
      <td>2350</td>
      <td>Nissan</td>
      <td>300ZX</td>
      <td>Automatic 4-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1984</td>
    </tr>
    <tr>
      <th>18223</th>
      <td>16</td>
      <td>18</td>
      <td>22</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>(FFS,TRBO)</td>
      <td>2350</td>
      <td>Nissan</td>
      <td>300ZX</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1984</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>20063</th>
      <td>13</td>
      <td>15</td>
      <td>19</td>
      <td>8.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>(FFS) CA model</td>
      <td>2800</td>
      <td>Mercury</td>
      <td>Grand Marquis Wagon</td>
      <td>Automatic 4-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1984</td>
    </tr>
    <tr>
      <th>20064</th>
      <td>13</td>
      <td>15</td>
      <td>20</td>
      <td>8.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>(GM-OLDS) CA model</td>
      <td>2800</td>
      <td>Oldsmobile</td>
      <td>Custom Cruiser Wagon</td>
      <td>Automatic 4-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1984</td>
    </tr>
    <tr>
      <th>20065</th>
      <td>14</td>
      <td>16</td>
      <td>19</td>
      <td>8.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>(GM-CHEV) CA model</td>
      <td>2650</td>
      <td>Pontiac</td>
      <td>Parisienne Wagon</td>
      <td>Automatic 4-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1984</td>
    </tr>
    <tr>
      <th>20387</th>
      <td>14</td>
      <td>14</td>
      <td>15</td>
      <td>4.0</td>
      <td>2.4</td>
      <td>NaN</td>
      <td>(FFS) CA model</td>
      <td>3000</td>
      <td>Nissan</td>
      <td>Pickup Cab Chassis</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1984</td>
    </tr>
    <tr>
      <th>21129</th>
      <td>14</td>
      <td>16</td>
      <td>21</td>
      <td>8.0</td>
      <td>3.5</td>
      <td>NaN</td>
      <td>GUZZLER  FFS,TURBO</td>
      <td>3250</td>
      <td>Lotus</td>
      <td>Esprit V8</td>
      <td>Manual 5-spd</td>
      <td>0</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2002</td>
    </tr>
    <tr>
      <th>23029</th>
      <td>79</td>
      <td>85</td>
      <td>94</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Lead Acid</td>
      <td>800</td>
      <td>GMC</td>
      <td>EV1</td>
      <td>Automatic (A1)</td>
      <td>55</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1999</td>
    </tr>
    <tr>
      <th>23030</th>
      <td>35</td>
      <td>37</td>
      <td>39</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NiMH</td>
      <td>1750</td>
      <td>GMC</td>
      <td>EV1</td>
      <td>Automatic (A1)</td>
      <td>105</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1999</td>
    </tr>
    <tr>
      <th>23032</th>
      <td>49</td>
      <td>48</td>
      <td>46</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1400</td>
      <td>Honda</td>
      <td>EV Plus</td>
      <td>Automatic (A1)</td>
      <td>81</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1999</td>
    </tr>
    <tr>
      <th>23037</th>
      <td>49</td>
      <td>48</td>
      <td>46</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1400</td>
      <td>Honda</td>
      <td>EV Plus</td>
      <td>Automatic (A1)</td>
      <td>81</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>1998</td>
    </tr>
    <tr>
      <th>23040</th>
      <td>102</td>
      <td>98</td>
      <td>94</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>650</td>
      <td>MINI</td>
      <td>MiniE</td>
      <td>Automatic (A1)</td>
      <td>100</td>
      <td>Tue Jan 01 00:00:00 EST 2013</td>
      <td>2008</td>
    </tr>
  </tbody>
</table>
<p>1189 rows × 14 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let's look at the drive column, grouped by year</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a> .groupby(<span class="st">'year'</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a> .drive</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a> .nunique()</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>year
1984    3
1985    4
1986    4
1987    3
1988    3
1989    3
1990    3
1991    3
1992    3
1993    3
1994    3
1995    4
1996    3
1997    4
1998    4
1999    4
2000    4
2001    4
2002    4
2003    4
2004    4
2005    4
2006    4
2007    4
2008    3
2009    4
2010    6
2011    5
2012    5
2013    5
2014    5
2015    5
2016    5
2017    5
2018    5
2019    5
2020    5
Name: drive, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let's convert drive to category, replacing NaN with 'Other using .assign .astype</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and convert make to category, updating .astype dictionary </span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># and check our memory usage</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a> .assign(cylinders<span class="op">=</span>autos.cylinders.fillna(<span class="dv">0</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>         displ<span class="op">=</span>autos.displ.fillna(<span class="dv">0</span>).astype(<span class="st">'float16'</span>),</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>         drive<span class="op">=</span>autos.drive.fillna(<span class="st">'Other'</span>).astype(<span class="st">'category'</span>))</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a> .astype({<span class="st">'city08'</span>: <span class="st">'int16'</span>, <span class="st">'comb08'</span>: <span class="st">'int16'</span>, <span class="st">'highway08'</span>: <span class="st">'int8'</span>,<span class="st">'fuelCost08'</span>:<span class="st">'int16'</span>, <span class="st">'range'</span>:<span class="st">'int16'</span>, <span class="st">'year'</span>:<span class="st">'int16'</span>, <span class="st">'make'</span>: <span class="st">'category'</span>}) </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a> .memory_usage(deep<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a> .<span class="bu">sum</span>() <span class="co"># was 19,647,323</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>12093275</code></pre>
</div>
</div>
<p>As we can see, converting to <strong>category</strong> has freed up a lot of space, a reduction from 17590123 - just over 30%</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's inspect trany </span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co"># looks like it has two pices of info embedded in the column</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a> .trany</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a> .value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>Automatic 4-spd                     11047
Manual 5-spd                         8361
Automatic 3-spd                      3151
Automatic (S6)                       3106
Manual 6-spd                         2757
Automatic 5-spd                      2203
Automatic (S8)                       1665
Automatic 6-spd                      1619
Manual 4-spd                         1483
Automatic (S5)                        833
Automatic (variable gear ratios)      826
Automatic 7-spd                       724
Automatic 8-spd                       433
Automatic (AM-S7)                     424
Automatic (S7)                        327
Automatic 9-spd                       293
Automatic (AM7)                       245
Automatic (S4)                        233
Automatic (AV-S6)                     208
Automatic (A1)                        201
Automatic (AM6)                       151
Automatic (AV-S7)                     139
Automatic (S10)                       124
Automatic (AM-S6)                     116
Manual 7-spd                          114
Automatic (S9)                         86
Manual 3-spd                           77
Automatic (AM-S8)                      60
Automatic (AV-S8)                      47
Automatic 10-spd                       25
Manual 4-spd Doubled                   17
Automatic (AM5)                        14
NaN                                    11
Automatic (AV-S10)                     11
Automatic (AM8)                         6
Automatic (AM-S9)                       3
Automatic (L3)                          2
Automatic (L4)                          2
Name: trany, dtype: int64</code></pre>
</div>
</div>
<p>11 NaN values</p>
<p>The information from the <em>trany</em> column seems to have two components:</p>
<ul>
<li>Automatic v Manual</li>
<li>Speed</li>
</ul>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add new columns for automatic using .str.contains</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># add new column for speeds using .str.extract</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># drop exisitng trany column</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a> .assign(cylinders<span class="op">=</span>autos.cylinders.fillna(<span class="dv">0</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>         displ<span class="op">=</span>autos.displ.fillna(<span class="dv">0</span>).astype(<span class="st">'float16'</span>),</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>         drive<span class="op">=</span>autos.drive.fillna(<span class="st">'Other'</span>).astype(<span class="st">'category'</span>),</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>         automatic<span class="op">=</span>autos.trany.<span class="bu">str</span>.contains(<span class="st">'Auto'</span>),</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>         speeds<span class="op">=</span>autos.trany.<span class="bu">str</span>.extract(<span class="vs">r'(\d)+'</span>).fillna(<span class="st">'20'</span>).astype(<span class="st">'int8'</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a> .astype({<span class="st">'city08'</span>: <span class="st">'int16'</span>, <span class="st">'comb08'</span>: <span class="st">'int16'</span>, <span class="st">'highway08'</span>: <span class="st">'int8'</span>,<span class="st">'fuelCost08'</span>:<span class="st">'int16'</span>, <span class="st">'range'</span>:<span class="st">'int16'</span>, <span class="st">'year'</span>:<span class="st">'int16'</span>, <span class="st">'make'</span>: <span class="st">'category'</span>}) </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a> .drop(columns<span class="op">=</span>[<span class="st">'trany'</span>])</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a> .memory_usage(deep<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a> .<span class="bu">sum</span>() <span class="co"># was 19,647,323</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>10631047</code></pre>
</div>
</div>
<p>Great, another reduction - we have almost halved our original memory usage.</p>
</section>
<section id="dates" class="level2">
<h2 class="anchored" data-anchor-id="dates">Dates</h2>
<p>pandas contains extensive capabilities and features for working with time series data for all domains. Check out the <a href="https://pandas.pydata.org/docs/user_guide/timeseries.html#overview">documentation</a> for more info.</p>
<p>We can convert the <em>CreatedOn</em> column from an object to datetime <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.dt.tz_localize.html">using</a>.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add createdOn using pd.to_datetime .dt.tz_localize</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a> .assign(cylinders<span class="op">=</span>autos.cylinders.fillna(<span class="dv">0</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>         displ<span class="op">=</span>autos.displ.fillna(<span class="dv">0</span>).astype(<span class="st">'float16'</span>),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>         drive<span class="op">=</span>autos.drive.fillna(<span class="st">'Other'</span>).astype(<span class="st">'category'</span>),</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>         automatic<span class="op">=</span>autos.trany.<span class="bu">str</span>.contains(<span class="st">'Auto'</span>),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>         speeds<span class="op">=</span>autos.trany.<span class="bu">str</span>.extract(<span class="vs">r'(\d)+'</span>).fillna(<span class="st">'20'</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>         createdOn<span class="op">=</span>pd.to_datetime(autos.createdOn).dt.tz_localize(<span class="st">'America/New_York'</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a> .astype({<span class="st">'city08'</span>: <span class="st">'int16'</span>, <span class="st">'comb08'</span>: <span class="st">'int16'</span>, <span class="st">'highway08'</span>: <span class="st">'int8'</span>,<span class="st">'fuelCost08'</span>:<span class="st">'int16'</span>, <span class="st">'range'</span>:<span class="st">'int16'</span>, <span class="st">'year'</span>:<span class="st">'int16'</span>, <span class="st">'make'</span>: <span class="st">'category'</span>}) </span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a> .drop(columns<span class="op">=</span>[<span class="st">'trany'</span>])</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a> .memory_usage(deep<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a> .<span class="bu">sum</span>() <span class="co"># was 19,647,323</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/stephen137/mambaforge/lib/python3.10/site-packages/dateutil/parser/_parser.py:1207: UnknownTimezoneWarning: tzname EST identified but not understood.  Pass `tzinfos` argument in order to correctly return a timezone-aware datetime.  In a future version, this will raise an exception.
  warnings.warn("tzname {tzname} identified but not understood.  "
/home/stephen137/mambaforge/lib/python3.10/site-packages/dateutil/parser/_parser.py:1207: UnknownTimezoneWarning: tzname EDT identified but not understood.  Pass `tzinfos` argument in order to correctly return a timezone-aware datetime.  In a future version, this will raise an exception.
  warnings.warn("tzname {tzname} identified but not understood.  "</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>7462959</code></pre>
</div>
</div>
<p>Excellent, we have successfully reduced our memory usage by 62%!</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pythom doesn't like EST/EDT</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a> .createdOn</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>0        Tue Jan 01 00:00:00 EST 2013
1        Tue Jan 01 00:00:00 EST 2013
2        Tue Jan 01 00:00:00 EST 2013
3        Tue Jan 01 00:00:00 EST 2013
4        Tue Jan 01 00:00:00 EST 2013
5        Tue Jan 01 00:00:00 EST 2013
6        Tue Jan 01 00:00:00 EST 2013
7        Tue Jan 01 00:00:00 EST 2013
8        Tue Jan 01 00:00:00 EST 2013
9        Tue Jan 01 00:00:00 EST 2013
                     ...             
41134    Tue Jan 01 00:00:00 EST 2013
41135    Tue Jan 01 00:00:00 EST 2013
41136    Tue Jan 01 00:00:00 EST 2013
41137    Tue Jan 01 00:00:00 EST 2013
41138    Tue Jan 01 00:00:00 EST 2013
41139    Tue Jan 01 00:00:00 EST 2013
41140    Tue Jan 01 00:00:00 EST 2013
41141    Tue Jan 01 00:00:00 EST 2013
41142    Tue Jan 01 00:00:00 EST 2013
41143    Tue Jan 01 00:00:00 EST 2013
Name: createdOn, Length: 41144, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix date warnings - move on to eng_dscr</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.fueleconomy.gov/feg/findacarhelp.shtml</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a> .assign(cylinders<span class="op">=</span>autos.cylinders.fillna(<span class="dv">0</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>         displ<span class="op">=</span>autos.displ.fillna(<span class="dv">0</span>).astype(<span class="st">'float16'</span>),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>         drive<span class="op">=</span>autos.drive.fillna(<span class="st">'Other'</span>).astype(<span class="st">'category'</span>),</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>         automatic<span class="op">=</span>autos.trany.<span class="bu">str</span>.contains(<span class="st">'Auto'</span>),</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>         speeds<span class="op">=</span>autos.trany.<span class="bu">str</span>.extract(<span class="vs">r'(\d)+'</span>).fillna(<span class="st">'20'</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>         createdOn<span class="op">=</span>pd.to_datetime(autos.createdOn.replace({<span class="st">'EDT'</span>: <span class="st">'-04:00'</span>, <span class="st">'EST'</span>:<span class="st">'-05:00'</span>}, regex<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a> .astype({<span class="st">'city08'</span>: <span class="st">'int16'</span>, <span class="st">'comb08'</span>: <span class="st">'int16'</span>, <span class="st">'highway08'</span>: <span class="st">'int8'</span>,<span class="st">'fuelCost08'</span>:<span class="st">'int16'</span>, <span class="st">'range'</span>:<span class="st">'int16'</span>, <span class="st">'year'</span>:<span class="st">'int16'</span>, <span class="st">'make'</span>: <span class="st">'category'</span>}) </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a> .drop(columns<span class="op">=</span>[<span class="st">'trany'</span>])</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a> .eng_dscr</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a> .value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>NaN                                 16153
(FFS)                                8827
SIDI                                 5526
(FFS) CA model                        926
(FFS)      (MPFI)                     734
FFV                                   701
(FFS,TRBO)                            666
(350 V8) (FFS)                        411
(GUZZLER)  (FFS)                      366
SOHC                                  354
                                    ...  
B234L/R4 (FFS,TRBO)                     1
GUZZLER V8 FFS,TURBO                    1
4.6M FFS MPFI                           1
CNG FFS                                 1
POLICE FFS MPFI                         1
B308E5 FFS,TURBO                        1
5.4E-R FFS MPFI                         1
V-6 FFS                                 1
(GUZZLER)  (FFS)      (S-CHARGE)        1
R-ENG (FFS,TRBO)                        1
Name: eng_dscr, Length: 558, dtype: int64</code></pre>
</div>
</div>
<p>As we can see the majority of values within the <em>eng_dscr</em> column are NaN and the other values are very messy. How should we deal with this?</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop eng_dscr column, and bring in an FFS column (feedback fuel system)</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># check update to memory usage</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>(autos</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a> [cols]</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a> .assign(cylinders<span class="op">=</span>autos.cylinders.fillna(<span class="dv">0</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>         displ<span class="op">=</span>autos.displ.fillna(<span class="dv">0</span>).astype(<span class="st">'float16'</span>),</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>         drive<span class="op">=</span>autos.drive.fillna(<span class="st">'Other'</span>).astype(<span class="st">'category'</span>),</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>         automatic<span class="op">=</span>autos.trany.<span class="bu">str</span>.contains(<span class="st">'Auto'</span>),</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>         speeds<span class="op">=</span>autos.trany.<span class="bu">str</span>.extract(<span class="vs">r'(\d)+'</span>).fillna(<span class="st">'20'</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>         createdOn<span class="op">=</span>pd.to_datetime(autos.createdOn.replace({<span class="st">'EDT'</span>: <span class="st">'-04:00'</span>, <span class="st">'EST'</span>:<span class="st">'-05:00'</span>}, regex<span class="op">=</span><span class="va">True</span>)),</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>         ffs<span class="op">=</span>autos.eng_dscr.<span class="bu">str</span>.contains(<span class="st">'FFS'</span>)</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a> .astype({<span class="st">'city08'</span>: <span class="st">'int16'</span>, <span class="st">'comb08'</span>: <span class="st">'int16'</span>, <span class="st">'highway08'</span>: <span class="st">'int8'</span>,<span class="st">'fuelCost08'</span>:<span class="st">'int16'</span>, <span class="st">'range'</span>:<span class="st">'int16'</span>, <span class="st">'year'</span>:<span class="st">'int16'</span>, <span class="st">'make'</span>: <span class="st">'category'</span>}) </span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a> .drop(columns<span class="op">=</span>[<span class="st">'trany'</span>,<span class="st">'eng_dscr'</span>])</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a> .memory_usage(deep<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a> .<span class="bu">sum</span>() <span class="co"># was 19,647,323</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>8676214</code></pre>
</div>
</div>
</section>
<section id="functions---.apply" class="level2">
<h2 class="anchored" data-anchor-id="functions---.apply">Functions - .apply</h2>
<p>Let’s now create a function which brings together all the exploratory data analysis we have performed in one place:</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> autos_tweak(autos):</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> [<span class="st">'city08'</span>,<span class="st">'comb08'</span>, <span class="st">'highway08'</span>,<span class="st">'cylinders'</span>, <span class="st">'displ'</span>, <span class="st">'drive'</span>, <span class="st">'eng_dscr'</span>, <span class="st">'fuelCost08'</span>,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">'make'</span>, <span class="st">'model'</span>, <span class="st">'trany'</span>, <span class="st">'range'</span>, <span class="st">'createdOn'</span>, <span class="st">'year'</span>]</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (autos</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    [cols]</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    .assign(cylinders<span class="op">=</span>autos.cylinders.fillna(<span class="dv">0</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>         displ<span class="op">=</span>autos.displ.fillna(<span class="dv">0</span>).astype(<span class="st">'float16'</span>),</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>         drive<span class="op">=</span>autos.drive.fillna(<span class="st">'Other'</span>).astype(<span class="st">'category'</span>),</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>         automatic<span class="op">=</span>autos.trany.<span class="bu">str</span>.contains(<span class="st">'Auto'</span>),</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>         speeds<span class="op">=</span>autos.trany.<span class="bu">str</span>.extract(<span class="vs">r'(\d)+'</span>).fillna(<span class="st">'20'</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>         createdOn<span class="op">=</span>pd.to_datetime(autos.createdOn.replace({<span class="st">'EDT'</span>: <span class="st">'-04:00'</span>, <span class="st">'EST'</span>:<span class="st">'-05:00'</span>}, regex<span class="op">=</span><span class="va">True</span>)),</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>         ffs<span class="op">=</span>autos.eng_dscr.<span class="bu">str</span>.contains(<span class="st">'FFS'</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>    .astype({<span class="st">'city08'</span>: <span class="st">'int16'</span>, <span class="st">'comb08'</span>: <span class="st">'int16'</span>,  <span class="st">'highway08'</span>: <span class="st">'int8'</span>,<span class="st">'fuelCost08'</span>:<span class="st">'int16'</span>, <span class="st">'range'</span>:<span class="st">'int16'</span>, <span class="st">'year'</span>:<span class="st">'int16'</span>, <span class="st">'make'</span>: <span class="st">'category'</span>}) </span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">'trany'</span>,<span class="st">'eng_dscr'</span>])</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Look how neat and tidy the above code is compared to the following alternative approach:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>a1 <span class="op">=</span> autos[cols]</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>cyls <span class="op">=</span> autos.cylinders.fillna(<span class="dv">0</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>cyls2 <span class="op">=</span> cyls.astype(<span class="st">'int8'</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>a1[<span class="st">'cylinders'</span>] <span class="op">=</span> cyls2</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>displ <span class="op">=</span> a1.displ</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>displ2 <span class="op">=</span> displ.fillna(<span class="dv">0</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>displ3<span class="op">=</span>displ2.astype(<span class="st">'float16'</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>a1.displ<span class="op">=</span>displ3</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>a1.drive<span class="op">=</span>autos.drive.fillna(<span class="st">'Other'</span>).astype(<span class="st">'category'</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>a1[<span class="st">'automatic'</span>] <span class="op">=</span> autos.trany.<span class="bu">str</span>.contains(<span class="st">'Auto'</span>)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>speed<span class="op">=</span>autos.trany.<span class="bu">str</span>.extract(<span class="vs">r'(\d)+'</span>)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>speedfill <span class="op">=</span> speed.fillna(<span class="st">'20'</span>)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>speedint <span class="op">=</span> speedfill.astype(<span class="st">'int8'</span>)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>a1[<span class="st">'speeds'</span>] <span class="op">=</span> speedint</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>a1.createdOn<span class="op">=</span>pd.to_datetime(autos.createdOn).dt.tz_localize(<span class="st">'America/New_York'</span>)</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>a1.ffs<span class="op">=</span>autos.eng_dscr.<span class="bu">str</span>.contains(<span class="st">'FFS'</span>)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>a1[<span class="st">'highway08'</span>] <span class="op">=</span> autos.highway08.astype(<span class="st">'int8'</span>)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>a1[<span class="st">'city08'</span>] <span class="op">=</span> autos.city08.astype(<span class="st">'int8'</span>)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>a1[<span class="st">'comb08'</span>] <span class="op">=</span> autos.comb08.astype(<span class="st">'int16'</span>)</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>a1[<span class="st">'fuelCost08'</span>] <span class="op">=</span>autos.fuelCost08.astype(<span class="st">'int16'</span>)</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>a1[<span class="st">'range'</span>] <span class="op">=</span> autos.<span class="bu">range</span>.astype(<span class="st">'int16'</span>)</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>a1[<span class="st">'make'</span>] <span class="op">=</span> autos.make.astype(<span class="st">'category'</span>)</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>a3 <span class="op">=</span> a1.drop(columns<span class="op">=</span>[<span class="st">'trany'</span>,<span class="st">'eng_dscr'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dont-mutate" class="level2">
<h2 class="anchored" data-anchor-id="dont-mutate">Don’t Mutate</h2>
<p>“you are missing the point, inplace <em>rarely</em> actually does something inplace. you are <em>thinking</em> that you are saving memory but you are not.”</p>
<p><strong>jreback</strong> - Pandas core dev</p>
<pre><code>https://github.com/pandas-dev/pandas/issues/16529#issuecomment-676518136</code></pre>
<ul>
<li>in general, no performance benefits</li>
<li>prohibits chaining</li>
<li>SettingWithCopyWarning fun</li>
</ul>
</section>
<section id="try-to-avoid-using-.apply-where-possible" class="level2">
<h2 class="anchored" data-anchor-id="try-to-avoid-using-.apply-where-possible">Try to avoid using .apply (where possible)</h2>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> autos_tweak(autos):</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> [<span class="st">'city08'</span>,<span class="st">'comb08'</span>, <span class="st">'highway08'</span>,<span class="st">'cylinders'</span>, <span class="st">'displ'</span>, <span class="st">'drive'</span>, <span class="st">'eng_dscr'</span>, <span class="st">'fuelCost08'</span>,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">'make'</span>, <span class="st">'model'</span>, <span class="st">'trany'</span>, <span class="st">'range'</span>, <span class="st">'createdOn'</span>, <span class="st">'year'</span>]</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (autos</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    [cols]</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    .assign(cylinders<span class="op">=</span>autos.cylinders.fillna(<span class="dv">0</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>         displ<span class="op">=</span>autos.displ.fillna(<span class="dv">0</span>).astype(<span class="st">'float16'</span>),</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>         drive<span class="op">=</span>autos.drive.fillna(<span class="st">'Other'</span>).astype(<span class="st">'category'</span>),</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>         automatic<span class="op">=</span>autos.trany.<span class="bu">str</span>.contains(<span class="st">'Auto'</span>),</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>         speeds<span class="op">=</span>autos.trany.<span class="bu">str</span>.extract(<span class="vs">r'(\d)+'</span>).fillna(<span class="st">'20'</span>).astype(<span class="st">'int8'</span>),</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>         createdOn<span class="op">=</span>pd.to_datetime(autos.createdOn.replace({<span class="st">'EDT'</span>: <span class="st">'-04:00'</span>, <span class="st">'EST'</span>:<span class="st">'-05:00'</span>}, regex<span class="op">=</span><span class="va">True</span>)),</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>         ffs<span class="op">=</span>autos.eng_dscr.<span class="bu">str</span>.contains(<span class="st">'FFS'</span>)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    .astype({<span class="st">'city08'</span>: <span class="st">'int16'</span>, <span class="st">'comb08'</span>: <span class="st">'int16'</span>,  <span class="st">'highway08'</span>: <span class="st">'int8'</span>,<span class="st">'fuelCost08'</span>:<span class="st">'int16'</span>, <span class="st">'range'</span>:<span class="st">'int16'</span>, <span class="st">'year'</span>:<span class="st">'int16'</span>, <span class="st">'make'</span>: <span class="st">'category'</span>}) </span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">'trany'</span>,<span class="st">'eng_dscr'</span>])</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>autos2 <span class="op">=</span> autos_tweak(autos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># try to be more Euro-centric</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_lper100km(val):</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">235.215</span> <span class="op">/</span> val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>autos2.city08.<span class="bu">apply</span>(to_lper100km)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5.3 ms ± 390 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<p>4.95 ms (milliseconds) is equivalent to 4,950 μs (microseconds)</p>
<p>There is a lot of computational overhead using this method - the function pulls out each individual entry from the Series, convert it to a Python object, pass the individual entry into the function, and then convert back to a pandas object.</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># note that you can't run %%timeit with a leading #comment</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># this gives the same results</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fl">235.215</span> <span class="op">/</span> autos2.city08</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>84.5 µs ± 3.29 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)</code></pre>
</div>
</div>
<p>90.7 μs (microseconds)</p>
<p>This gives the same answer but is more than 50 x faster than using the .apply method, because it is leveraging modern CPU <a href="https://en.wikipedia.org/wiki/Single_instruction,_multiple_data">single instruction multiple data</a> (SIMD) architecture - here’s a block of data - do the division on it.</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a function to return whether the make of the car is US</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_american(val):</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> val <span class="kw">in</span> {<span class="st">'Chevrolet'</span>, <span class="st">'Ford'</span>, <span class="st">'Dodge'</span>, <span class="st">'GMC'</span>, <span class="st">'Tesla'</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use .apply</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>autos2.make.<span class="bu">apply</span>(is_american)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>233 µs ± 6.36 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)</code></pre>
</div>
</div>
<p>245 μs (microseconds)</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use .isin </span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>autos2.make.isin({<span class="st">'Chevrolet'</span>, <span class="st">'Ford'</span>, <span class="st">'Dodge'</span>, <span class="st">'GMC'</span>, <span class="st">'Tesla'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>448 µs ± 9.32 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)</code></pre>
</div>
</div>
<p>465 μs (microseconds)</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use .astype(str) and then .isin</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>autos2.make.astype(<span class="bu">str</span>).isin({<span class="st">'Chevrolet'</span>, <span class="st">'Ford'</span>, <span class="st">'Dodge'</span>, <span class="st">'GMC'</span>, <span class="st">'Tesla'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4.91 ms ± 65.2 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<p>5.35 ms (milliseconds) is equivalent to 5,350 μs (microseconds)</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use .astype(str) and then .apply</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>autos2.make.astype(<span class="bu">str</span>).<span class="bu">apply</span>(is_american)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>8.23 ms ± 241 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<p>8.93 ms (milliseconds) is equivalent to 8,930 μs (microseconds)</p>
<p>In the case of the categorical column - make:</p>
<ul>
<li>the .apply method on the function was fastest</li>
<li>the .isin method was next fastest (~ 2 x slower)</li>
<li>third fastest was (~ 22 x slower)</li>
<li>finally the .astype(str).apply method (~36 x slower)</li>
</ul>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> country(val):</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> val <span class="kw">in</span> {<span class="st">'Chevrolet'</span>, <span class="st">'Ford'</span>, <span class="st">'Dodge'</span>, <span class="st">'GMC'</span>, <span class="st">'Tesla'</span>}:</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'US'</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># else</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'Other'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use .apply</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Might be OK for strings, since they are not vectorized...</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a> .assign(country<span class="op">=</span>autos2.make.<span class="bu">apply</span>(country))</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2.14 ms ± 66.5 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use .assign</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> {<span class="st">'Chevrolet'</span>, <span class="st">'Ford'</span>, <span class="st">'Dodge'</span>, <span class="st">'GMC'</span>, <span class="st">'Tesla'</span>}</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a> .assign(country<span class="op">=</span><span class="st">'US'</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a> .assign(country<span class="op">=</span><span class="kw">lambda</span> df_:df_.country.where(df_.make.isin(values), <span class="st">'Other'</span>))</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4.31 ms ± 83 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># using MumPy .select - allows you to specify a list of Booleans, and wherever they hold true [i.e make is Chevrolet, Ford, Dodge...Tesla, you specify the value ['US'] to put into placeholder </span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># this method is not available within pandas</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a> .assign(country<span class="op">=</span>np.select([autos2.make.isin({<span class="st">'Chevrolet'</span>, <span class="st">'Ford'</span>, <span class="st">'Dodge'</span>, <span class="st">'GMC'</span>, <span class="st">'Tesla'</span>})],</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>                           [<span class="st">'US'</span>], <span class="st">'Other'</span>))</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>)                          </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3.36 ms ± 145 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co"># using MumPy .where - allows you to specify a list of Booleans, and wherever they hold true [i.e make is Chevrolet, Ford, Dodge...Tesla, you specify the value ['US'] to put into placeholder </span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># this method is not available within pandas</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a> .assign(country<span class="op">=</span>np.where(autos2.make.isin({<span class="st">'Chevrolet'</span>, <span class="st">'Ford'</span>, <span class="st">'Dodge'</span>, <span class="st">'GMC'</span>, <span class="st">'Tesla'</span>}),</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>                           [<span class="st">'US'</span>], <span class="st">'Other'</span>))</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3.38 ms ± 35.2 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<p>Key takeaways</p>
<ul>
<li>if you find yourself using a for loop alarm bells should be ringing!</li>
<li>you could use .apply but still slow</li>
<li>apply where or np.select</li>
<li>the same result can be obtained much faster using list comprehension</li>
</ul>
</section>
<section id="aggregation" class="level2">
<h2 class="anchored" data-anchor-id="aggregation">Aggregation</h2>
<p>It is important as a data science to work with the raw data and get to know the finer details, but ultimately, providing higher level insights are our main goal. This can be obtained by aggregating data. Let’s compare mileage by country by year…</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start off with auto</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co"># group by year</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co"># then grab the mean values</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># Year will therefore be our index</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a> .groupby(<span class="st">'year'</span>)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a> .mean()</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_2753/262800323.py:7: FutureWarning: The default value of numeric_only in DataFrameGroupBy.mean is deprecated. In a future version, numeric_only will default to False. Either specify numeric_only or select only columns which should be valid for the function.
  .mean()</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="53">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>city08</th>
      <th>comb08</th>
      <th>highway08</th>
      <th>cylinders</th>
      <th>displ</th>
      <th>fuelCost08</th>
      <th>range</th>
      <th>speeds</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1984</th>
      <td>17.982688</td>
      <td>19.881874</td>
      <td>23.075356</td>
      <td>5.385438</td>
      <td>3.165017</td>
      <td>2313.543788</td>
      <td>0.000000</td>
      <td>3.928208</td>
    </tr>
    <tr>
      <th>1985</th>
      <td>17.878307</td>
      <td>19.808348</td>
      <td>23.042328</td>
      <td>5.375661</td>
      <td>3.164080</td>
      <td>2334.509112</td>
      <td>0.000000</td>
      <td>3.924750</td>
    </tr>
    <tr>
      <th>1986</th>
      <td>17.665289</td>
      <td>19.550413</td>
      <td>22.699174</td>
      <td>5.425620</td>
      <td>3.183762</td>
      <td>2354.049587</td>
      <td>0.000000</td>
      <td>3.984298</td>
    </tr>
    <tr>
      <th>1987</th>
      <td>17.310345</td>
      <td>19.228549</td>
      <td>22.445068</td>
      <td>5.412189</td>
      <td>3.173949</td>
      <td>2403.648757</td>
      <td>0.000000</td>
      <td>4.037690</td>
    </tr>
    <tr>
      <th>1988</th>
      <td>17.333628</td>
      <td>19.328319</td>
      <td>22.702655</td>
      <td>5.461947</td>
      <td>3.194899</td>
      <td>2387.035398</td>
      <td>0.000000</td>
      <td>4.129204</td>
    </tr>
    <tr>
      <th>1989</th>
      <td>17.143972</td>
      <td>19.125759</td>
      <td>22.465742</td>
      <td>5.488291</td>
      <td>3.209926</td>
      <td>2433.434519</td>
      <td>0.000000</td>
      <td>4.166522</td>
    </tr>
    <tr>
      <th>1990</th>
      <td>17.033395</td>
      <td>19.000928</td>
      <td>22.337662</td>
      <td>5.496289</td>
      <td>3.217369</td>
      <td>2436.178108</td>
      <td>0.000000</td>
      <td>4.238404</td>
    </tr>
    <tr>
      <th>1991</th>
      <td>16.848940</td>
      <td>18.825972</td>
      <td>22.253534</td>
      <td>5.598940</td>
      <td>3.266809</td>
      <td>2490.856890</td>
      <td>0.000000</td>
      <td>4.301237</td>
    </tr>
    <tr>
      <th>1992</th>
      <td>16.805531</td>
      <td>18.862623</td>
      <td>22.439786</td>
      <td>5.623550</td>
      <td>3.276159</td>
      <td>2494.736842</td>
      <td>0.000000</td>
      <td>4.318466</td>
    </tr>
    <tr>
      <th>1993</th>
      <td>16.998170</td>
      <td>19.104300</td>
      <td>22.780421</td>
      <td>5.602928</td>
      <td>3.248540</td>
      <td>2454.620311</td>
      <td>0.000000</td>
      <td>4.339433</td>
    </tr>
    <tr>
      <th>1994</th>
      <td>16.918534</td>
      <td>19.012220</td>
      <td>22.725051</td>
      <td>5.704684</td>
      <td>3.333190</td>
      <td>2461.507128</td>
      <td>0.000000</td>
      <td>4.332994</td>
    </tr>
    <tr>
      <th>1995</th>
      <td>16.569804</td>
      <td>18.797311</td>
      <td>22.671148</td>
      <td>5.892451</td>
      <td>3.471776</td>
      <td>2497.828335</td>
      <td>0.000000</td>
      <td>4.356774</td>
    </tr>
    <tr>
      <th>1996</th>
      <td>17.289780</td>
      <td>19.584735</td>
      <td>23.569211</td>
      <td>5.627426</td>
      <td>3.234789</td>
      <td>2375.032342</td>
      <td>0.000000</td>
      <td>4.364812</td>
    </tr>
    <tr>
      <th>1997</th>
      <td>17.135171</td>
      <td>19.429134</td>
      <td>23.451444</td>
      <td>5.666667</td>
      <td>3.226933</td>
      <td>2405.511811</td>
      <td>0.000000</td>
      <td>4.402887</td>
    </tr>
    <tr>
      <th>1998</th>
      <td>17.113300</td>
      <td>19.518473</td>
      <td>23.546798</td>
      <td>5.633005</td>
      <td>3.201979</td>
      <td>2382.635468</td>
      <td>0.229064</td>
      <td>4.419951</td>
    </tr>
    <tr>
      <th>1999</th>
      <td>17.272300</td>
      <td>19.611502</td>
      <td>23.552817</td>
      <td>5.667840</td>
      <td>3.188794</td>
      <td>2392.194836</td>
      <td>0.570423</td>
      <td>4.421362</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>17.221429</td>
      <td>19.526190</td>
      <td>23.414286</td>
      <td>5.713095</td>
      <td>3.200517</td>
      <td>2429.702381</td>
      <td>0.348810</td>
      <td>4.508333</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>17.275521</td>
      <td>19.479693</td>
      <td>23.328211</td>
      <td>5.720088</td>
      <td>3.192452</td>
      <td>2448.463227</td>
      <td>0.261251</td>
      <td>4.660812</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>16.893333</td>
      <td>19.168205</td>
      <td>23.030769</td>
      <td>5.827692</td>
      <td>3.264525</td>
      <td>2479.794872</td>
      <td>0.136410</td>
      <td>4.757949</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>16.780651</td>
      <td>19.000958</td>
      <td>22.836207</td>
      <td>5.942529</td>
      <td>3.358259</td>
      <td>2525.574713</td>
      <td>0.090996</td>
      <td>4.911877</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>16.740642</td>
      <td>19.067736</td>
      <td>23.064171</td>
      <td>5.957219</td>
      <td>3.393626</td>
      <td>2512.566845</td>
      <td>0.000000</td>
      <td>4.976827</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>16.851630</td>
      <td>19.193825</td>
      <td>23.297599</td>
      <td>5.944254</td>
      <td>3.399485</td>
      <td>2518.610635</td>
      <td>0.000000</td>
      <td>5.192110</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>16.626812</td>
      <td>18.959239</td>
      <td>23.048913</td>
      <td>6.100543</td>
      <td>3.549294</td>
      <td>2539.175725</td>
      <td>0.000000</td>
      <td>5.315217</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>16.605684</td>
      <td>18.978686</td>
      <td>23.083481</td>
      <td>6.166075</td>
      <td>3.628539</td>
      <td>2535.923623</td>
      <td>0.000000</td>
      <td>5.610124</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>16.900590</td>
      <td>19.276327</td>
      <td>23.455771</td>
      <td>6.192923</td>
      <td>3.637796</td>
      <td>2536.436394</td>
      <td>0.084246</td>
      <td>5.773378</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>17.334459</td>
      <td>19.735642</td>
      <td>24.017736</td>
      <td>6.122466</td>
      <td>3.624839</td>
      <td>2427.027027</td>
      <td>0.000000</td>
      <td>6.043074</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>18.105500</td>
      <td>20.588819</td>
      <td>24.947701</td>
      <td>5.965735</td>
      <td>3.502548</td>
      <td>2351.082056</td>
      <td>0.000000</td>
      <td>6.271416</td>
    </tr>
    <tr>
      <th>2011</th>
      <td>18.669027</td>
      <td>21.011504</td>
      <td>25.169912</td>
      <td>5.980531</td>
      <td>3.521903</td>
      <td>2333.982301</td>
      <td>0.259292</td>
      <td>6.560177</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>19.362847</td>
      <td>21.819444</td>
      <td>26.105035</td>
      <td>5.910590</td>
      <td>3.460015</td>
      <td>2289.973958</td>
      <td>0.782118</td>
      <td>6.706597</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>20.661318</td>
      <td>23.125000</td>
      <td>27.504223</td>
      <td>5.762669</td>
      <td>3.327529</td>
      <td>2210.768581</td>
      <td>1.255068</td>
      <td>6.896959</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>21.033469</td>
      <td>23.531429</td>
      <td>27.978776</td>
      <td>5.745306</td>
      <td>3.289703</td>
      <td>2198.040816</td>
      <td>1.405714</td>
      <td>6.985306</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>21.445830</td>
      <td>24.038971</td>
      <td>28.586906</td>
      <td>5.635230</td>
      <td>3.205085</td>
      <td>2148.869836</td>
      <td>2.208106</td>
      <td>7.035853</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>22.591918</td>
      <td>25.150555</td>
      <td>29.606973</td>
      <td>5.463550</td>
      <td>3.054415</td>
      <td>2091.204437</td>
      <td>4.546751</td>
      <td>7.080032</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>22.761021</td>
      <td>25.249033</td>
      <td>29.554524</td>
      <td>5.453210</td>
      <td>3.026032</td>
      <td>2096.558391</td>
      <td>4.336427</td>
      <td>7.225058</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>22.564732</td>
      <td>25.019345</td>
      <td>29.273065</td>
      <td>5.438988</td>
      <td>2.992239</td>
      <td>2103.980655</td>
      <td>3.519345</td>
      <td>7.017113</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>23.318147</td>
      <td>25.627942</td>
      <td>29.664389</td>
      <td>5.368261</td>
      <td>2.964679</td>
      <td>2093.545938</td>
      <td>5.565680</td>
      <td>7.136674</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>22.679426</td>
      <td>25.267943</td>
      <td>29.617225</td>
      <td>5.071770</td>
      <td>2.644994</td>
      <td>2023.444976</td>
      <td>2.282297</td>
      <td>7.746411</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let's focus on just the comb08 and speeds columns</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a> .groupby(<span class="st">'year'</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a> [[<span class="st">'comb08'</span>,<span class="st">'speeds'</span>]]</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a> .mean()</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>comb08</th>
      <th>speeds</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1984</th>
      <td>19.881874</td>
      <td>3.928208</td>
    </tr>
    <tr>
      <th>1985</th>
      <td>19.808348</td>
      <td>3.924750</td>
    </tr>
    <tr>
      <th>1986</th>
      <td>19.550413</td>
      <td>3.984298</td>
    </tr>
    <tr>
      <th>1987</th>
      <td>19.228549</td>
      <td>4.037690</td>
    </tr>
    <tr>
      <th>1988</th>
      <td>19.328319</td>
      <td>4.129204</td>
    </tr>
    <tr>
      <th>1989</th>
      <td>19.125759</td>
      <td>4.166522</td>
    </tr>
    <tr>
      <th>1990</th>
      <td>19.000928</td>
      <td>4.238404</td>
    </tr>
    <tr>
      <th>1991</th>
      <td>18.825972</td>
      <td>4.301237</td>
    </tr>
    <tr>
      <th>1992</th>
      <td>18.862623</td>
      <td>4.318466</td>
    </tr>
    <tr>
      <th>1993</th>
      <td>19.104300</td>
      <td>4.339433</td>
    </tr>
    <tr>
      <th>1994</th>
      <td>19.012220</td>
      <td>4.332994</td>
    </tr>
    <tr>
      <th>1995</th>
      <td>18.797311</td>
      <td>4.356774</td>
    </tr>
    <tr>
      <th>1996</th>
      <td>19.584735</td>
      <td>4.364812</td>
    </tr>
    <tr>
      <th>1997</th>
      <td>19.429134</td>
      <td>4.402887</td>
    </tr>
    <tr>
      <th>1998</th>
      <td>19.518473</td>
      <td>4.419951</td>
    </tr>
    <tr>
      <th>1999</th>
      <td>19.611502</td>
      <td>4.421362</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>19.526190</td>
      <td>4.508333</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>19.479693</td>
      <td>4.660812</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>19.168205</td>
      <td>4.757949</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>19.000958</td>
      <td>4.911877</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>19.067736</td>
      <td>4.976827</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>19.193825</td>
      <td>5.192110</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>18.959239</td>
      <td>5.315217</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>18.978686</td>
      <td>5.610124</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>19.276327</td>
      <td>5.773378</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>19.735642</td>
      <td>6.043074</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>20.588819</td>
      <td>6.271416</td>
    </tr>
    <tr>
      <th>2011</th>
      <td>21.011504</td>
      <td>6.560177</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>21.819444</td>
      <td>6.706597</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>23.125000</td>
      <td>6.896959</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>23.531429</td>
      <td>6.985306</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>24.038971</td>
      <td>7.035853</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>25.150555</td>
      <td>7.080032</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>25.249033</td>
      <td>7.225058</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>25.019345</td>
      <td>7.017113</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>25.627942</td>
      <td>7.136674</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>25.267943</td>
      <td>7.746411</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Watch out for the ordering!!!</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># here we are grouping by year</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co"># but then we are taking average of all columns - computationally expensive</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># we are only interested in comb08 and speeds</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a> .groupby(<span class="st">'year'</span>)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a> .mean()</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a> <span class="co">#.median()</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a> <span class="co">#.quantile(.1)</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a> <span class="co">#.std()</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a> [[<span class="st">'comb08'</span>,<span class="st">'speeds'</span>]]</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizations" class="level2">
<h2 class="anchored" data-anchor-id="visualizations">Visualizations</h2>
<p>The pandas library includes a variety of <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/visualization.html">visualization tools</a> which allow us to communicate our findings visually. Note that is very easy to show a variety of different plots quickly, simply by commenting out (#) to leave the desired plot:</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in pandas default plot is a line plot</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with index as the x axis and the selected grouped columns as the lines</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a> .groupby(<span class="st">'Time_mins'</span>)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  [[<span class="st">'comb08'</span>,<span class="st">'speeds'</span>]]</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a> <span class="co">#.mean()</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a> <span class="co">#.median()</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a> <span class="co">#.quantile(.1)</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a> .std()</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a> <span class="co">#.var()</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a> .plot()</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>&lt;AxesSubplot: xlabel='year'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Effective_Pandas_files/figure-html/cell-57-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add country</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a> .assign(country<span class="op">=</span>autos2.make.<span class="bu">apply</span>(country))</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># can group by more than one column</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a> .groupby([<span class="st">'year'</span>,<span class="st">'country'</span>])</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a> .mean()</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_2753/361744348.py:6: FutureWarning: The default value of numeric_only in DataFrameGroupBy.mean is deprecated. In a future version, numeric_only will default to False. Either specify numeric_only or select only columns which should be valid for the function.
  .mean()</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="57">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>city08</th>
      <th>comb08</th>
      <th>highway08</th>
      <th>cylinders</th>
      <th>displ</th>
      <th>fuelCost08</th>
      <th>range</th>
      <th>speeds</th>
    </tr>
    <tr>
      <th>year</th>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">1984</th>
      <th>Other</th>
      <td>19.384615</td>
      <td>21.417330</td>
      <td>24.847038</td>
      <td>4.908046</td>
      <td>2.690516</td>
      <td>2118.125553</td>
      <td>0.000000</td>
      <td>3.969054</td>
    </tr>
    <tr>
      <th>US</th>
      <td>16.079232</td>
      <td>17.797119</td>
      <td>20.669868</td>
      <td>6.033613</td>
      <td>3.809268</td>
      <td>2578.871549</td>
      <td>0.000000</td>
      <td>3.872749</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1985</th>
      <th>Other</th>
      <td>19.284768</td>
      <td>21.373068</td>
      <td>24.816777</td>
      <td>4.871965</td>
      <td>2.636070</td>
      <td>2141.997792</td>
      <td>0.000000</td>
      <td>3.958057</td>
    </tr>
    <tr>
      <th>US</th>
      <td>16.275472</td>
      <td>18.025157</td>
      <td>21.020126</td>
      <td>5.949686</td>
      <td>3.765813</td>
      <td>2553.899371</td>
      <td>0.000000</td>
      <td>3.886792</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1986</th>
      <th>Other</th>
      <td>19.167183</td>
      <td>21.213622</td>
      <td>24.650155</td>
      <td>4.804954</td>
      <td>2.536234</td>
      <td>2149.148607</td>
      <td>0.000000</td>
      <td>4.069659</td>
    </tr>
    <tr>
      <th>US</th>
      <td>15.945035</td>
      <td>17.645390</td>
      <td>20.464539</td>
      <td>6.136525</td>
      <td>3.925433</td>
      <td>2588.741135</td>
      <td>0.000000</td>
      <td>3.886525</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1987</th>
      <th>Other</th>
      <td>18.633381</td>
      <td>20.710414</td>
      <td>24.186876</td>
      <td>4.825963</td>
      <td>2.583168</td>
      <td>2227.318117</td>
      <td>0.000000</td>
      <td>4.142653</td>
    </tr>
    <tr>
      <th>US</th>
      <td>15.611722</td>
      <td>17.326007</td>
      <td>20.208791</td>
      <td>6.164835</td>
      <td>3.932442</td>
      <td>2630.036630</td>
      <td>0.000000</td>
      <td>3.902930</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1988</th>
      <th>Other</th>
      <td>18.668224</td>
      <td>20.814642</td>
      <td>24.437695</td>
      <td>4.819315</td>
      <td>2.531434</td>
      <td>2207.476636</td>
      <td>0.000000</td>
      <td>4.205607</td>
    </tr>
    <tr>
      <th>US</th>
      <td>15.577869</td>
      <td>17.372951</td>
      <td>20.420082</td>
      <td>6.307377</td>
      <td>4.067735</td>
      <td>2623.258197</td>
      <td>0.000000</td>
      <td>4.028689</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2016</th>
      <th>Other</th>
      <td>21.903749</td>
      <td>24.439716</td>
      <td>28.866261</td>
      <td>5.493414</td>
      <td>2.992272</td>
      <td>2127.608916</td>
      <td>1.017224</td>
      <td>7.296859</td>
    </tr>
    <tr>
      <th>US</th>
      <td>25.061818</td>
      <td>27.701818</td>
      <td>32.265455</td>
      <td>5.356364</td>
      <td>3.277454</td>
      <td>1960.545455</td>
      <td>17.214545</td>
      <td>6.301818</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2017</th>
      <th>Other</th>
      <td>22.423795</td>
      <td>24.910521</td>
      <td>29.208456</td>
      <td>5.431662</td>
      <td>2.919041</td>
      <td>2114.110128</td>
      <td>1.243854</td>
      <td>7.474926</td>
    </tr>
    <tr>
      <th>US</th>
      <td>24.003623</td>
      <td>26.496377</td>
      <td>30.829710</td>
      <td>5.532609</td>
      <td>3.420272</td>
      <td>2031.884058</td>
      <td>15.731884</td>
      <td>6.304348</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2018</th>
      <th>Other</th>
      <td>22.310442</td>
      <td>24.779868</td>
      <td>29.042333</td>
      <td>5.396990</td>
      <td>2.886801</td>
      <td>2121.448730</td>
      <td>1.135466</td>
      <td>7.391345</td>
    </tr>
    <tr>
      <th>US</th>
      <td>23.526690</td>
      <td>25.925267</td>
      <td>30.145907</td>
      <td>5.597865</td>
      <td>3.391101</td>
      <td>2037.900356</td>
      <td>12.537367</td>
      <td>5.601423</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2019</th>
      <th>Other</th>
      <td>23.084221</td>
      <td>25.456922</td>
      <td>29.560503</td>
      <td>5.315586</td>
      <td>2.839671</td>
      <td>2093.659245</td>
      <td>2.581801</td>
      <td>7.545983</td>
    </tr>
    <tr>
      <th>US</th>
      <td>24.169014</td>
      <td>26.250000</td>
      <td>30.042254</td>
      <td>5.559859</td>
      <td>3.419375</td>
      <td>2093.133803</td>
      <td>16.419014</td>
      <td>5.647887</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2020</th>
      <th>Other</th>
      <td>22.579487</td>
      <td>25.174359</td>
      <td>29.543590</td>
      <td>5.148718</td>
      <td>2.692823</td>
      <td>2050.256410</td>
      <td>2.446154</td>
      <td>7.743590</td>
    </tr>
    <tr>
      <th>US</th>
      <td>24.071429</td>
      <td>26.571429</td>
      <td>30.642857</td>
      <td>4.000000</td>
      <td>1.978795</td>
      <td>1650.000000</td>
      <td>0.000000</td>
      <td>7.785714</td>
    </tr>
  </tbody>
</table>
<p>74 rows × 8 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can go deeper and apply multiple aggregates</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this is loosely equivalent to the sort of thing that a pivot table in Excel might provide</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co"># penultimate row</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> second_to_last(ser):</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ser.iloc[<span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a> .assign(country<span class="op">=</span>autos2.make.<span class="bu">apply</span>(country))</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a> .groupby([<span class="st">'year'</span>, <span class="st">'country'</span>])</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="co"># we can use .agg to include a list of different aggregation types - we can even call a function</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a> .agg([<span class="st">'min'</span>, <span class="st">'mean'</span>, second_to_last])</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_2753/2706922386.py:12: FutureWarning: ['drive', 'make', 'model', 'createdOn'] did not aggregate successfully. If any error is raised this will raise in a future version of pandas. Drop these columns/ops to avoid this warning.
  .agg(['min', 'mean', second_to_last])</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="58">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="3" halign="left">city08</th>
      <th colspan="3" halign="left">comb08</th>
      <th colspan="3" halign="left">highway08</th>
      <th>cylinders</th>
      <th>...</th>
      <th>range</th>
      <th colspan="3" halign="left">automatic</th>
      <th colspan="3" halign="left">speeds</th>
      <th colspan="3" halign="left">ffs</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>min</th>
      <th>mean</th>
      <th>second_to_last</th>
      <th>min</th>
      <th>mean</th>
      <th>second_to_last</th>
      <th>min</th>
      <th>mean</th>
      <th>second_to_last</th>
      <th>min</th>
      <th>...</th>
      <th>second_to_last</th>
      <th>min</th>
      <th>mean</th>
      <th>second_to_last</th>
      <th>min</th>
      <th>mean</th>
      <th>second_to_last</th>
      <th>min</th>
      <th>mean</th>
      <th>second_to_last</th>
    </tr>
    <tr>
      <th>year</th>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">1984</th>
      <th>Other</th>
      <td>7</td>
      <td>19.384615</td>
      <td>14</td>
      <td>8</td>
      <td>21.417330</td>
      <td>14</td>
      <td>9</td>
      <td>24.847038</td>
      <td>15</td>
      <td>2</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.550840</td>
      <td>False</td>
      <td>3</td>
      <td>3.969054</td>
      <td>5</td>
      <td>False</td>
      <td>0.714554</td>
      <td>True</td>
    </tr>
    <tr>
      <th>US</th>
      <td>8</td>
      <td>16.079232</td>
      <td>15</td>
      <td>9</td>
      <td>17.797119</td>
      <td>17</td>
      <td>10</td>
      <td>20.669868</td>
      <td>19</td>
      <td>4</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.521059</td>
      <td>False</td>
      <td>3</td>
      <td>3.872749</td>
      <td>4</td>
      <td>False</td>
      <td>0.638801</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1985</th>
      <th>Other</th>
      <td>7</td>
      <td>19.284768</td>
      <td>19</td>
      <td>8</td>
      <td>21.373068</td>
      <td>20</td>
      <td>9</td>
      <td>24.816777</td>
      <td>22</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.554084</td>
      <td>True</td>
      <td>3</td>
      <td>3.958057</td>
      <td>4</td>
      <td>False</td>
      <td>0.889160</td>
      <td>True</td>
    </tr>
    <tr>
      <th>US</th>
      <td>8</td>
      <td>16.275472</td>
      <td>14</td>
      <td>10</td>
      <td>18.025157</td>
      <td>15</td>
      <td>10</td>
      <td>21.020126</td>
      <td>17</td>
      <td>3</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.520755</td>
      <td>False</td>
      <td>3</td>
      <td>3.886792</td>
      <td>4</td>
      <td>False</td>
      <td>0.851351</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1986</th>
      <th>Other</th>
      <td>6</td>
      <td>19.167183</td>
      <td>10</td>
      <td>7</td>
      <td>21.213622</td>
      <td>11</td>
      <td>9</td>
      <td>24.650155</td>
      <td>12</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.520124</td>
      <td>False</td>
      <td>3</td>
      <td>4.069659</td>
      <td>4</td>
      <td>False</td>
      <td>0.934211</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>US</th>
      <td>9</td>
      <td>15.945035</td>
      <td>16</td>
      <td>10</td>
      <td>17.645390</td>
      <td>17</td>
      <td>11</td>
      <td>20.464539</td>
      <td>19</td>
      <td>3</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.533688</td>
      <td>False</td>
      <td>3</td>
      <td>3.886525</td>
      <td>4</td>
      <td>False</td>
      <td>0.795699</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1987</th>
      <th>Other</th>
      <td>6</td>
      <td>18.633381</td>
      <td>12</td>
      <td>7</td>
      <td>20.710414</td>
      <td>12</td>
      <td>9</td>
      <td>24.186876</td>
      <td>12</td>
      <td>2</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.516405</td>
      <td>True</td>
      <td>3</td>
      <td>4.142653</td>
      <td>4</td>
      <td>False</td>
      <td>0.949778</td>
      <td>True</td>
    </tr>
    <tr>
      <th>US</th>
      <td>8</td>
      <td>15.611722</td>
      <td>12</td>
      <td>9</td>
      <td>17.326007</td>
      <td>13</td>
      <td>10</td>
      <td>20.208791</td>
      <td>14</td>
      <td>3</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.549451</td>
      <td>True</td>
      <td>3</td>
      <td>3.902930</td>
      <td>4</td>
      <td>False</td>
      <td>0.909457</td>
      <td>True</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1988</th>
      <th>Other</th>
      <td>6</td>
      <td>18.668224</td>
      <td>12</td>
      <td>7</td>
      <td>20.814642</td>
      <td>12</td>
      <td>10</td>
      <td>24.437695</td>
      <td>12</td>
      <td>2</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.521807</td>
      <td>True</td>
      <td>3</td>
      <td>4.205607</td>
      <td>4</td>
      <td>False</td>
      <td>0.993681</td>
      <td>True</td>
    </tr>
    <tr>
      <th>US</th>
      <td>8</td>
      <td>15.577869</td>
      <td>14</td>
      <td>9</td>
      <td>17.372951</td>
      <td>14</td>
      <td>10</td>
      <td>20.420082</td>
      <td>15</td>
      <td>3</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.569672</td>
      <td>True</td>
      <td>3</td>
      <td>4.028689</td>
      <td>4</td>
      <td>False</td>
      <td>0.936306</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2016</th>
      <th>Other</th>
      <td>10</td>
      <td>21.903749</td>
      <td>28</td>
      <td>12</td>
      <td>24.439716</td>
      <td>30</td>
      <td>13</td>
      <td>28.866261</td>
      <td>32</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.837893</td>
      <td>True</td>
      <td>1</td>
      <td>7.296859</td>
      <td>7</td>
      <td>False</td>
      <td>0.000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>US</th>
      <td>11</td>
      <td>25.061818</td>
      <td>91</td>
      <td>12</td>
      <td>27.701818</td>
      <td>93</td>
      <td>16</td>
      <td>32.265455</td>
      <td>94</td>
      <td>0</td>
      <td>...</td>
      <td>200</td>
      <td>False</td>
      <td>0.850909</td>
      <td>True</td>
      <td>1</td>
      <td>6.301818</td>
      <td>1</td>
      <td>False</td>
      <td>0.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2017</th>
      <th>Other</th>
      <td>10</td>
      <td>22.423795</td>
      <td>21</td>
      <td>11</td>
      <td>24.910521</td>
      <td>24</td>
      <td>11</td>
      <td>29.208456</td>
      <td>28</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.848574</td>
      <td>True</td>
      <td>1</td>
      <td>7.474926</td>
      <td>7</td>
      <td>False</td>
      <td>0.000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>US</th>
      <td>11</td>
      <td>24.003623</td>
      <td>131</td>
      <td>12</td>
      <td>26.496377</td>
      <td>126</td>
      <td>15</td>
      <td>30.829710</td>
      <td>120</td>
      <td>0</td>
      <td>...</td>
      <td>310</td>
      <td>False</td>
      <td>0.858696</td>
      <td>True</td>
      <td>0</td>
      <td>6.304348</td>
      <td>1</td>
      <td>False</td>
      <td>0.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2018</th>
      <th>Other</th>
      <td>9</td>
      <td>22.310442</td>
      <td>11</td>
      <td>11</td>
      <td>24.779868</td>
      <td>12</td>
      <td>11</td>
      <td>29.042333</td>
      <td>15</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.863594</td>
      <td>True</td>
      <td>0</td>
      <td>7.391345</td>
      <td>0</td>
      <td>False</td>
      <td>0.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>US</th>
      <td>11</td>
      <td>23.526690</td>
      <td>120</td>
      <td>14</td>
      <td>25.925267</td>
      <td>116</td>
      <td>15</td>
      <td>30.145907</td>
      <td>112</td>
      <td>0</td>
      <td>...</td>
      <td>310</td>
      <td>False</td>
      <td>0.882562</td>
      <td>True</td>
      <td>0</td>
      <td>5.601423</td>
      <td>1</td>
      <td>False</td>
      <td>0.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2019</th>
      <th>Other</th>
      <td>9</td>
      <td>23.084221</td>
      <td>19</td>
      <td>11</td>
      <td>25.456922</td>
      <td>22</td>
      <td>14</td>
      <td>29.560503</td>
      <td>27</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.879961</td>
      <td>True</td>
      <td>0</td>
      <td>7.545983</td>
      <td>8</td>
      <td>False</td>
      <td>0.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>US</th>
      <td>11</td>
      <td>24.169014</td>
      <td>104</td>
      <td>14</td>
      <td>26.250000</td>
      <td>104</td>
      <td>15</td>
      <td>30.042254</td>
      <td>104</td>
      <td>0</td>
      <td>...</td>
      <td>345</td>
      <td>False</td>
      <td>0.915493</td>
      <td>True</td>
      <td>0</td>
      <td>5.647887</td>
      <td>1</td>
      <td>False</td>
      <td>0.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2020</th>
      <th>Other</th>
      <td>13</td>
      <td>22.579487</td>
      <td>17</td>
      <td>15</td>
      <td>25.174359</td>
      <td>20</td>
      <td>18</td>
      <td>29.543590</td>
      <td>24</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.871795</td>
      <td>True</td>
      <td>0</td>
      <td>7.743590</td>
      <td>0</td>
      <td>False</td>
      <td>0.000000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>US</th>
      <td>20</td>
      <td>24.071429</td>
      <td>21</td>
      <td>22</td>
      <td>26.571429</td>
      <td>24</td>
      <td>26</td>
      <td>30.642857</td>
      <td>28</td>
      <td>4</td>
      <td>...</td>
      <td>0</td>
      <td>False</td>
      <td>0.857143</td>
      <td>True</td>
      <td>0</td>
      <td>7.785714</td>
      <td>0</td>
      <td>False</td>
      <td>0.000000</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>74 rows × 30 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># back to simpler example, adding plots</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a> .assign(country<span class="op">=</span>autos2.make.<span class="bu">apply</span>(country))</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># can group by more than one column</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a> .groupby([<span class="st">'year'</span>,<span class="st">'country'</span>])</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a> .mean()</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a> .plot()</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_2753/1855101905.py:6: FutureWarning: The default value of numeric_only in DataFrameGroupBy.mean is deprecated. In a future version, numeric_only will default to False. Either specify numeric_only or select only columns which should be valid for the function.
  .mean()</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>&lt;AxesSubplot: xlabel='year,country'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Effective_Pandas_files/figure-html/cell-60-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>This doesn’t really work as we can see. Let’s see if we can resolve this:</p>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># back to simpler example, adding plots</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a> .assign(country<span class="op">=</span>autos2.make.<span class="bu">apply</span>(country))</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># can group by more than one column</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a> .groupby([<span class="st">'year'</span>,<span class="st">'country'</span>])</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a> .mean()</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a> <span class="co"># rotates or unstacks the innermost index, country</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a> .unstack()</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_2753/1937283994.py:6: FutureWarning: The default value of numeric_only in DataFrameGroupBy.mean is deprecated. In a future version, numeric_only will default to False. Either specify numeric_only or select only columns which should be valid for the function.
  .mean()</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="60">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">city08</th>
      <th colspan="2" halign="left">comb08</th>
      <th colspan="2" halign="left">highway08</th>
      <th colspan="2" halign="left">cylinders</th>
      <th colspan="2" halign="left">displ</th>
      <th colspan="2" halign="left">fuelCost08</th>
      <th colspan="2" halign="left">range</th>
      <th colspan="2" halign="left">speeds</th>
    </tr>
    <tr>
      <th>country</th>
      <th>Other</th>
      <th>US</th>
      <th>Other</th>
      <th>US</th>
      <th>Other</th>
      <th>US</th>
      <th>Other</th>
      <th>US</th>
      <th>Other</th>
      <th>US</th>
      <th>Other</th>
      <th>US</th>
      <th>Other</th>
      <th>US</th>
      <th>Other</th>
      <th>US</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1984</th>
      <td>19.384615</td>
      <td>16.079232</td>
      <td>21.417330</td>
      <td>17.797119</td>
      <td>24.847038</td>
      <td>20.669868</td>
      <td>4.908046</td>
      <td>6.033613</td>
      <td>2.690516</td>
      <td>3.809268</td>
      <td>2118.125553</td>
      <td>2578.871549</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>3.969054</td>
      <td>3.872749</td>
    </tr>
    <tr>
      <th>1985</th>
      <td>19.284768</td>
      <td>16.275472</td>
      <td>21.373068</td>
      <td>18.025157</td>
      <td>24.816777</td>
      <td>21.020126</td>
      <td>4.871965</td>
      <td>5.949686</td>
      <td>2.636070</td>
      <td>3.765813</td>
      <td>2141.997792</td>
      <td>2553.899371</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>3.958057</td>
      <td>3.886792</td>
    </tr>
    <tr>
      <th>1986</th>
      <td>19.167183</td>
      <td>15.945035</td>
      <td>21.213622</td>
      <td>17.645390</td>
      <td>24.650155</td>
      <td>20.464539</td>
      <td>4.804954</td>
      <td>6.136525</td>
      <td>2.536234</td>
      <td>3.925433</td>
      <td>2149.148607</td>
      <td>2588.741135</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.069659</td>
      <td>3.886525</td>
    </tr>
    <tr>
      <th>1987</th>
      <td>18.633381</td>
      <td>15.611722</td>
      <td>20.710414</td>
      <td>17.326007</td>
      <td>24.186876</td>
      <td>20.208791</td>
      <td>4.825963</td>
      <td>6.164835</td>
      <td>2.583168</td>
      <td>3.932442</td>
      <td>2227.318117</td>
      <td>2630.036630</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.142653</td>
      <td>3.902930</td>
    </tr>
    <tr>
      <th>1988</th>
      <td>18.668224</td>
      <td>15.577869</td>
      <td>20.814642</td>
      <td>17.372951</td>
      <td>24.437695</td>
      <td>20.420082</td>
      <td>4.819315</td>
      <td>6.307377</td>
      <td>2.531434</td>
      <td>4.067735</td>
      <td>2207.476636</td>
      <td>2623.258197</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.205607</td>
      <td>4.028689</td>
    </tr>
    <tr>
      <th>1989</th>
      <td>18.533040</td>
      <td>15.139831</td>
      <td>20.662261</td>
      <td>16.908898</td>
      <td>24.252570</td>
      <td>19.887712</td>
      <td>4.879589</td>
      <td>6.366525</td>
      <td>2.542154</td>
      <td>4.173385</td>
      <td>2250.000000</td>
      <td>2698.093220</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.264317</td>
      <td>4.025424</td>
    </tr>
    <tr>
      <th>1990</th>
      <td>18.510109</td>
      <td>14.850575</td>
      <td>20.640747</td>
      <td>16.577011</td>
      <td>24.267496</td>
      <td>19.485057</td>
      <td>4.839813</td>
      <td>6.466667</td>
      <td>2.508090</td>
      <td>4.265798</td>
      <td>2238.258165</td>
      <td>2728.735632</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.328149</td>
      <td>4.105747</td>
    </tr>
    <tr>
      <th>1991</th>
      <td>18.087943</td>
      <td>14.803279</td>
      <td>20.174468</td>
      <td>16.599532</td>
      <td>23.809929</td>
      <td>19.683841</td>
      <td>5.029787</td>
      <td>6.538642</td>
      <td>2.610219</td>
      <td>4.350876</td>
      <td>2348.581560</td>
      <td>2725.761124</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.341844</td>
      <td>4.234192</td>
    </tr>
    <tr>
      <th>1992</th>
      <td>17.915374</td>
      <td>14.895631</td>
      <td>20.098731</td>
      <td>16.735437</td>
      <td>23.820874</td>
      <td>20.063107</td>
      <td>5.145275</td>
      <td>6.446602</td>
      <td>2.709618</td>
      <td>4.251104</td>
      <td>2373.272214</td>
      <td>2703.762136</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.356841</td>
      <td>4.252427</td>
    </tr>
    <tr>
      <th>1993</th>
      <td>18.084866</td>
      <td>15.007772</td>
      <td>20.309760</td>
      <td>16.896373</td>
      <td>24.172560</td>
      <td>20.230570</td>
      <td>5.114569</td>
      <td>6.497409</td>
      <td>2.683870</td>
      <td>4.282793</td>
      <td>2333.097595</td>
      <td>2677.202073</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.371994</td>
      <td>4.279793</td>
    </tr>
    <tr>
      <th>1994</th>
      <td>18.046474</td>
      <td>14.952514</td>
      <td>20.264423</td>
      <td>16.829609</td>
      <td>24.173077</td>
      <td>20.201117</td>
      <td>5.185897</td>
      <td>6.608939</td>
      <td>2.713631</td>
      <td>4.413091</td>
      <td>2326.041667</td>
      <td>2697.625698</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.355769</td>
      <td>4.293296</td>
    </tr>
    <tr>
      <th>1995</th>
      <td>17.678914</td>
      <td>14.533724</td>
      <td>20.091054</td>
      <td>16.422287</td>
      <td>24.263578</td>
      <td>19.747801</td>
      <td>5.444089</td>
      <td>6.715543</td>
      <td>2.908022</td>
      <td>4.506701</td>
      <td>2355.191693</td>
      <td>2759.677419</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.380192</td>
      <td>4.313783</td>
    </tr>
    <tr>
      <th>1996</th>
      <td>18.480545</td>
      <td>14.926641</td>
      <td>20.906615</td>
      <td>16.961390</td>
      <td>25.093385</td>
      <td>20.544402</td>
      <td>5.147860</td>
      <td>6.579151</td>
      <td>2.708768</td>
      <td>4.278708</td>
      <td>2250.291829</td>
      <td>2622.586873</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.416342</td>
      <td>4.262548</td>
    </tr>
    <tr>
      <th>1997</th>
      <td>18.090909</td>
      <td>14.978632</td>
      <td>20.509470</td>
      <td>16.991453</td>
      <td>24.678030</td>
      <td>20.683761</td>
      <td>5.261364</td>
      <td>6.581197</td>
      <td>2.786582</td>
      <td>4.220544</td>
      <td>2319.128788</td>
      <td>2600.427350</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>4.452652</td>
      <td>4.290598</td>
    </tr>
    <tr>
      <th>1998</th>
      <td>17.925267</td>
      <td>15.288000</td>
      <td>20.457295</td>
      <td>17.408000</td>
      <td>24.704626</td>
      <td>20.944000</td>
      <td>5.275801</td>
      <td>6.436000</td>
      <td>2.800378</td>
      <td>4.104777</td>
      <td>2295.373665</td>
      <td>2578.800000</td>
      <td>0.144128</td>
      <td>0.420000</td>
      <td>4.485765</td>
      <td>4.272000</td>
    </tr>
    <tr>
      <th>1999</th>
      <td>17.925125</td>
      <td>15.709163</td>
      <td>20.386023</td>
      <td>17.756972</td>
      <td>24.577371</td>
      <td>21.099602</td>
      <td>5.377704</td>
      <td>6.362550</td>
      <td>2.832181</td>
      <td>4.042677</td>
      <td>2312.728785</td>
      <td>2582.470120</td>
      <td>0.251248</td>
      <td>1.334661</td>
      <td>4.507488</td>
      <td>4.215139</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>17.881849</td>
      <td>15.714844</td>
      <td>20.301370</td>
      <td>17.757812</td>
      <td>24.416096</td>
      <td>21.128906</td>
      <td>5.441781</td>
      <td>6.332031</td>
      <td>2.859111</td>
      <td>3.979351</td>
      <td>2385.958904</td>
      <td>2529.492188</td>
      <td>0.304795</td>
      <td>0.449219</td>
      <td>4.619863</td>
      <td>4.253906</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>17.941267</td>
      <td>15.643939</td>
      <td>20.289026</td>
      <td>17.496212</td>
      <td>24.372488</td>
      <td>20.768939</td>
      <td>5.479134</td>
      <td>6.310606</td>
      <td>2.872808</td>
      <td>3.975823</td>
      <td>2399.536321</td>
      <td>2568.371212</td>
      <td>0.187017</td>
      <td>0.443182</td>
      <td>4.761978</td>
      <td>4.412879</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>17.644412</td>
      <td>15.083916</td>
      <td>20.076923</td>
      <td>16.979021</td>
      <td>24.207547</td>
      <td>20.195804</td>
      <td>5.576197</td>
      <td>6.433566</td>
      <td>2.935398</td>
      <td>4.057423</td>
      <td>2425.689405</td>
      <td>2610.139860</td>
      <td>0.137881</td>
      <td>0.132867</td>
      <td>4.920174</td>
      <td>4.367133</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>17.565101</td>
      <td>14.826087</td>
      <td>19.953020</td>
      <td>16.628763</td>
      <td>24.052349</td>
      <td>19.806020</td>
      <td>5.683221</td>
      <td>6.588629</td>
      <td>3.032161</td>
      <td>4.170778</td>
      <td>2480.604027</td>
      <td>2637.625418</td>
      <td>0.127517</td>
      <td>0.000000</td>
      <td>5.154362</td>
      <td>4.307692</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>17.426290</td>
      <td>14.928571</td>
      <td>19.923833</td>
      <td>16.805195</td>
      <td>24.160934</td>
      <td>20.165584</td>
      <td>5.729730</td>
      <td>6.558442</td>
      <td>3.088666</td>
      <td>4.199593</td>
      <td>2476.719902</td>
      <td>2607.305195</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5.229730</td>
      <td>4.308442</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>17.412170</td>
      <td>15.196610</td>
      <td>19.892078</td>
      <td>17.132203</td>
      <td>24.189437</td>
      <td>20.664407</td>
      <td>5.773823</td>
      <td>6.447458</td>
      <td>3.151592</td>
      <td>4.131402</td>
      <td>2493.455798</td>
      <td>2592.881356</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5.362801</td>
      <td>4.688136</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>17.062575</td>
      <td>15.300366</td>
      <td>19.509025</td>
      <td>17.285714</td>
      <td>23.762936</td>
      <td>20.875458</td>
      <td>5.977136</td>
      <td>6.476190</td>
      <td>3.345220</td>
      <td>4.170487</td>
      <td>2527.496992</td>
      <td>2574.725275</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5.492178</td>
      <td>4.776557</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>16.996403</td>
      <td>15.489726</td>
      <td>19.452038</td>
      <td>17.626712</td>
      <td>23.742206</td>
      <td>21.202055</td>
      <td>6.044365</td>
      <td>6.513699</td>
      <td>3.423963</td>
      <td>4.212841</td>
      <td>2544.664269</td>
      <td>2510.958904</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5.864508</td>
      <td>4.883562</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>17.239869</td>
      <td>15.770073</td>
      <td>19.677985</td>
      <td>17.937956</td>
      <td>23.983571</td>
      <td>21.697080</td>
      <td>6.095290</td>
      <td>6.518248</td>
      <td>3.462049</td>
      <td>4.223408</td>
      <td>2551.369113</td>
      <td>2486.678832</td>
      <td>0.109529</td>
      <td>0.000000</td>
      <td>5.969332</td>
      <td>5.120438</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>17.696803</td>
      <td>16.148014</td>
      <td>20.186329</td>
      <td>18.259928</td>
      <td>24.590959</td>
      <td>22.140794</td>
      <td>5.970232</td>
      <td>6.620939</td>
      <td>3.402613</td>
      <td>4.352489</td>
      <td>2433.076075</td>
      <td>2407.220217</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6.189636</td>
      <td>5.563177</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>18.325342</td>
      <td>17.278970</td>
      <td>20.851598</td>
      <td>19.600858</td>
      <td>25.256849</td>
      <td>23.785408</td>
      <td>5.897260</td>
      <td>6.223176</td>
      <td>3.357208</td>
      <td>4.048979</td>
      <td>2374.429224</td>
      <td>2263.304721</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6.378995</td>
      <td>5.866953</td>
    </tr>
    <tr>
      <th>2011</th>
      <td>19.247387</td>
      <td>16.817844</td>
      <td>21.635308</td>
      <td>19.014870</td>
      <td>25.855981</td>
      <td>22.973978</td>
      <td>5.851336</td>
      <td>6.394052</td>
      <td>3.319702</td>
      <td>4.169094</td>
      <td>2326.248548</td>
      <td>2358.736059</td>
      <td>0.340302</td>
      <td>0.000000</td>
      <td>6.714286</td>
      <td>6.066914</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>19.838052</td>
      <td>17.802974</td>
      <td>22.339751</td>
      <td>20.111524</td>
      <td>26.695357</td>
      <td>24.167286</td>
      <td>5.792752</td>
      <td>6.297398</td>
      <td>3.268908</td>
      <td>4.087332</td>
      <td>2282.502831</td>
      <td>2314.498141</td>
      <td>0.634202</td>
      <td>1.267658</td>
      <td>6.834655</td>
      <td>6.286245</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>20.982888</td>
      <td>19.453815</td>
      <td>23.471658</td>
      <td>21.823293</td>
      <td>27.860963</td>
      <td>26.164659</td>
      <td>5.658824</td>
      <td>6.152610</td>
      <td>3.179253</td>
      <td>3.884311</td>
      <td>2208.288770</td>
      <td>2220.080321</td>
      <td>0.853476</td>
      <td>2.763052</td>
      <td>7.033155</td>
      <td>6.385542</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>21.159919</td>
      <td>20.506329</td>
      <td>23.655870</td>
      <td>23.012658</td>
      <td>28.088057</td>
      <td>27.523207</td>
      <td>5.719636</td>
      <td>5.852321</td>
      <td>3.211738</td>
      <td>3.614723</td>
      <td>2212.196356</td>
      <td>2139.029536</td>
      <td>0.859312</td>
      <td>3.683544</td>
      <td>7.210526</td>
      <td>6.046414</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>21.350000</td>
      <td>21.817490</td>
      <td>23.935294</td>
      <td>24.441065</td>
      <td>28.481373</td>
      <td>28.996198</td>
      <td>5.604902</td>
      <td>5.752852</td>
      <td>3.101696</td>
      <td>3.606063</td>
      <td>2164.215686</td>
      <td>2089.353612</td>
      <td>0.638235</td>
      <td>8.296578</td>
      <td>7.211765</td>
      <td>6.353612</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>21.903749</td>
      <td>25.061818</td>
      <td>24.439716</td>
      <td>27.701818</td>
      <td>28.866261</td>
      <td>32.265455</td>
      <td>5.493414</td>
      <td>5.356364</td>
      <td>2.992272</td>
      <td>3.277454</td>
      <td>2127.608916</td>
      <td>1960.545455</td>
      <td>1.017224</td>
      <td>17.214545</td>
      <td>7.296859</td>
      <td>6.301818</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>22.423795</td>
      <td>24.003623</td>
      <td>24.910521</td>
      <td>26.496377</td>
      <td>29.208456</td>
      <td>30.829710</td>
      <td>5.431662</td>
      <td>5.532609</td>
      <td>2.919041</td>
      <td>3.420272</td>
      <td>2114.110128</td>
      <td>2031.884058</td>
      <td>1.243854</td>
      <td>15.731884</td>
      <td>7.474926</td>
      <td>6.304348</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>22.310442</td>
      <td>23.526690</td>
      <td>24.779868</td>
      <td>25.925267</td>
      <td>29.042333</td>
      <td>30.145907</td>
      <td>5.396990</td>
      <td>5.597865</td>
      <td>2.886801</td>
      <td>3.391101</td>
      <td>2121.448730</td>
      <td>2037.900356</td>
      <td>1.135466</td>
      <td>12.537367</td>
      <td>7.391345</td>
      <td>5.601423</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>23.084221</td>
      <td>24.169014</td>
      <td>25.456922</td>
      <td>26.250000</td>
      <td>29.560503</td>
      <td>30.042254</td>
      <td>5.315586</td>
      <td>5.559859</td>
      <td>2.839671</td>
      <td>3.419375</td>
      <td>2093.659245</td>
      <td>2093.133803</td>
      <td>2.581801</td>
      <td>16.419014</td>
      <td>7.545983</td>
      <td>5.647887</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>22.579487</td>
      <td>24.071429</td>
      <td>25.174359</td>
      <td>26.571429</td>
      <td>29.543590</td>
      <td>30.642857</td>
      <td>5.148718</td>
      <td>4.000000</td>
      <td>2.692823</td>
      <td>1.978795</td>
      <td>2050.256410</td>
      <td>1650.000000</td>
      <td>2.446154</td>
      <td>0.000000</td>
      <td>7.743590</td>
      <td>7.785714</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># back to simpler example, adding plots</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a> .assign(country<span class="op">=</span>autos2.make.<span class="bu">apply</span>(country))</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># can group by more than one column</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a> .groupby([<span class="st">'year'</span>,<span class="st">'country'</span>])</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a> .mean()</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a> <span class="co"># .std()</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a> <span class="co"># rotates or unstacks the innermost index, country</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a> .unstack()</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a> <span class="co"># focus on city08 column</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a> .city08</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a> .plot()</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a> .legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_2753/2308684326.py:6: FutureWarning: The default value of numeric_only in DataFrameGroupBy.mean is deprecated. In a future version, numeric_only will default to False. Either specify numeric_only or select only columns which should be valid for the function.
  .mean()</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>&lt;matplotlib.legend.Legend at 0x7f2091b75e10&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Effective_Pandas_files/figure-html/cell-62-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># time series smoothing - rolling average(2)</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a> .assign(country<span class="op">=</span>autos2.make.<span class="bu">apply</span>(country))</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># can group by more than one column</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a> .groupby([<span class="st">'year'</span>,<span class="st">'country'</span>])</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a> .mean()</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a> <span class="co"># .std()</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a> <span class="co"># rotates or unstacks the innermost index, country</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a> .unstack()</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a> <span class="co"># focus on city08 column</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a> .city08</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a> <span class="co"># rolling average to smooth time series</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a> .rolling(<span class="dv">2</span>)</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a> .mean()</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a> .plot()</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a> .legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_2753/2271732648.py:6: FutureWarning: The default value of numeric_only in DataFrameGroupBy.mean is deprecated. In a future version, numeric_only will default to False. Either specify numeric_only or select only columns which should be valid for the function.
  .mean()</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>&lt;matplotlib.legend.Legend at 0x7f2091a62ad0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Effective_Pandas_files/figure-html/cell-63-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># can we emulate a SQL GROUP BY - HAVING query?</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="co"># let's only show grouped values over say 750</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vals_gt(df_, num):</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_[df_.gt(num)].dropna()</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>(autos2</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a> .assign(country<span class="op">=</span>autos2.make.<span class="bu">apply</span>(country))</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a> <span class="co"># can group by more than one column</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a> .groupby([<span class="st">'year'</span>,<span class="st">'country'</span>])</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a> .count()</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a> .pipe(vals_gt, <span class="dv">750</span>)</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>city08</th>
      <th>comb08</th>
      <th>highway08</th>
      <th>cylinders</th>
      <th>displ</th>
      <th>drive</th>
      <th>fuelCost08</th>
      <th>make</th>
      <th>model</th>
      <th>range</th>
      <th>createdOn</th>
      <th>automatic</th>
      <th>speeds</th>
      <th>ffs</th>
    </tr>
    <tr>
      <th>year</th>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1984</th>
      <th>Other</th>
      <td>1131.0</td>
      <td>1131.0</td>
      <td>1131.0</td>
      <td>1131.0</td>
      <td>1131.0</td>
      <td>1131.0</td>
      <td>1131.0</td>
      <td>1131.0</td>
      <td>1131.0</td>
      <td>1131.0</td>
      <td>1131.0</td>
      <td>1131.0</td>
      <td>1131.0</td>
      <td>1065.0</td>
    </tr>
    <tr>
      <th>1985</th>
      <th>Other</th>
      <td>906.0</td>
      <td>906.0</td>
      <td>906.0</td>
      <td>906.0</td>
      <td>906.0</td>
      <td>906.0</td>
      <td>906.0</td>
      <td>906.0</td>
      <td>906.0</td>
      <td>906.0</td>
      <td>906.0</td>
      <td>906.0</td>
      <td>906.0</td>
      <td>821.0</td>
    </tr>
    <tr>
      <th>2017</th>
      <th>Other</th>
      <td>1017.0</td>
      <td>1017.0</td>
      <td>1017.0</td>
      <td>1017.0</td>
      <td>1017.0</td>
      <td>1017.0</td>
      <td>1017.0</td>
      <td>1017.0</td>
      <td>1017.0</td>
      <td>1017.0</td>
      <td>1017.0</td>
      <td>1017.0</td>
      <td>1017.0</td>
      <td>766.0</td>
    </tr>
    <tr>
      <th>2018</th>
      <th>Other</th>
      <td>1063.0</td>
      <td>1063.0</td>
      <td>1063.0</td>
      <td>1063.0</td>
      <td>1063.0</td>
      <td>1063.0</td>
      <td>1063.0</td>
      <td>1063.0</td>
      <td>1063.0</td>
      <td>1063.0</td>
      <td>1063.0</td>
      <td>1063.0</td>
      <td>1063.0</td>
      <td>844.0</td>
    </tr>
    <tr>
      <th>2019</th>
      <th>Other</th>
      <td>1033.0</td>
      <td>1033.0</td>
      <td>1033.0</td>
      <td>1033.0</td>
      <td>1033.0</td>
      <td>1033.0</td>
      <td>1033.0</td>
      <td>1033.0</td>
      <td>1033.0</td>
      <td>1033.0</td>
      <td>1033.0</td>
      <td>1033.0</td>
      <td>1033.0</td>
      <td>855.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key takeaways</h2>
<p>Having code that is clean, readable and has a logical flow is invaluable. Structured Query Language (SQL), as the name suggests, already pushes you down this road. Python, although often referred to as the swiss army knife of programming languages, can quickly beocme scattered and difficult to follow particulary during the exploratory data analysis (EDA) phase. However by adopting the <strong>chaining</strong> method covered in this blog, your code should ensure that others (as well as yourself!) can follow exactly what is going on.</p>
<p>Although computer memory continues to get cheaper, I think it is good practice to keep track of how much data is being used, and there are some interesting ways covered in this blog as to how we might go about achieving this. e.g.&nbsp;<a href="https://numpy.org/doc/stable/reference/generated/numpy.iinfo.html">numpy.iinfo</a>. In the same breath, <em>speed</em> is also of the essence, and the handy Python cell magic <em>%%timeit</em> provides an easy way to quantify this. With pandas there is generally a variety of different ways to arrive at the same outcome, but as this blog covers there can be substantial time savings if you know which method to use and when, and which to avoid if possible, in particular the use of <em>.apply</em>.</p>
<p>This blog has been produced in response to the <strong>Effective Pandas</strong> video presented by <strong><a href="https://twitter.com/__mharrison__">Matt Harrison</a></strong> which you can view below. Thanks also to <strong><a href="https://twitter.com/svpino">Santiago</a></strong> for the heads up on Twitter.</p>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>HTML</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>iframe width<span class="op">=</span><span class="st">"560"</span> height<span class="op">=</span><span class="st">"315"</span> src<span class="op">=</span><span class="st">"https://www.youtube.com/embed/zgbUk90aQ6A?start=482"</span> title<span class="op">=</span><span class="st">"YouTube video player"</span> frameborder<span class="op">=</span><span class="st">"0"</span> allow<span class="op">=</span><span class="st">"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"</span> allowfullscreen<span class="op">&gt;&lt;/</span>iframe<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<iframe width="560" height="315" src="https://www.youtube.com/embed/zgbUk90aQ6A?start=482" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</div>
</div>
<p>If the above <strong><em>%%HTML</em></strong> cell magic is unfamiliar to you, then I recommend you watch the excellent video below posted by <strong><a href="https://twitter.com/coreymschafer">Corey Shafer</a></strong>. An excellent introduction for anyone starting out with Jupyter NoteBooks.</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>HTML</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>iframe width<span class="op">=</span><span class="st">"560"</span> height<span class="op">=</span><span class="st">"315"</span> src<span class="op">=</span><span class="st">"https://www.youtube.com/embed/HW29067qVWk"</span> title<span class="op">=</span><span class="st">"YouTube video player"</span> frameborder<span class="op">=</span><span class="st">"0"</span> allow<span class="op">=</span><span class="st">"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"</span> allowfullscreen<span class="op">&gt;&lt;/</span>iframe<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<iframe width="560" height="315" src="https://www.youtube.com/embed/HW29067qVWk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>